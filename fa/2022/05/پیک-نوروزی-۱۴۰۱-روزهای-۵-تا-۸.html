<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>پیک نوروزی ۱۴۰۱ - روزهای ۵ تا ۸</title>
    <meta name="description" content="در طی نوروز ۱۴۰۱، در ۸ توویت با هش‌تگ #پیک‌نوروزی ۸ سوال و تمرین مطرح کردم. در این بلاگ‌پست و  بخش قبل  این سوال‌ها و پاسخ‌ها را آورده‌ام.  در این بخش:   روز ۵. پیاده‌سازی اپراتور LIKE روز ۶. جایزه‌های اسمولیان   روز ۷. چاپ همه‌ی درخت‌های دودویی   روز ۸. ...">
    <meta name="author"      content="هادی مشیدی">
    <meta name="keywords"    content="چالش‌برنامه‌نویسی">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/fa/favicon.svg">
    <link rel="canonical" href="http://pykello.github.com/fa//fa/2022/05/%D9%BE%DB%8C%DA%A9-%D9%86%D9%88%D8%B1%D9%88%D8%B2%DB%8C-%DB%B1%DB%B4%DB%B0%DB%B1-%D8%B1%D9%88%D8%B2%D9%87%D8%A7%DB%8C-%DB%B5-%D8%AA%D8%A7-%DB%B8.html">
    <link rel="next" href="/fa/2022/05/%D9%BE%DB%8C%DA%A9-%D9%86%D9%88%D8%B1%D9%88%D8%B2%DB%8C-%DB%B1%DB%B4%DB%B0%DB%B1-%D8%B1%D9%88%D8%B2%D9%87%D8%A7%DB%8C-%DB%B1-%D8%AA%D8%A7-%DB%B4.html">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/fa/css/monochrome.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/custom.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/fa/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/fa/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>

    <!-- Header -->

    <header id="header" class="parent justify-spaceBetween">
      <div class="inner w100 relative">
        <span class="f-left">
          <a href="/fa">
            <h1>
              <span>the</span>lost<span>packet</span>
            </h1>
          </a>
        </span>
      </div>
    </header>

    <div id="container">
        <main>
            <article>
  <header>
    <h1>پیک نوروزی ۱۴۰۱ - روزهای ۵ تا ۸</h1>
    <p class='date-and-tags'>
<time datetime="2022-05-06" pubdate="true">2022-05-06</time> :: <span class="tags"><a href="/fa/tags/%DA%86%D8%A7%D9%84%D8%B4-%D8%A8%D8%B1%D9%86%D8%A7%D9%85%D9%87-%D9%86%D9%88%DB%8C%D8%B3%DB%8C.html">چالش‌برنامه‌نویسی</a></span></p>
    <p class='authors'><span class="authors">هادی مشیدی</span></p>
  </header>

<p>در طی نوروز ۱۴۰۱، در ۸ توویت با هش‌تگ #پیک‌نوروزی ۸ سوال و تمرین مطرح کردم. در این بلاگ‌پست و  <a href="/fa/2022/05/%D9%BE%DB%8C%DA%A9-%D9%86%D9%88%D8%B1%D9%88%D8%B2%DB%8C-%DB%B1%DB%B4%DB%B0%DB%B1-%D8%B1%D9%88%D8%B2%D9%87%D8%A7%DB%8C-%DB%B1-%D8%AA%D8%A7-%DB%B4.html">بخش قبل</a>  این سوال‌ها و پاسخ‌ها را آورده‌ام.</p>

<p>در این بخش:</p>

<ul>
 <li>روز ۵. پیاده‌سازی اپراتور LIKE</li>
 <li>روز ۶. جایزه‌های اسمولیان</li>
 <li>روز ۷. چاپ همه‌ی درخت‌های دودویی</li>
 <li>روز ۸. اختلاف سرعت sum1 و sum2</li></ul>
<!-- more-->

<h2 id="روز-۵-پیادهسازی-اپراتور-like">روز ۵. پیاده‌سازی اپراتور LIKE</h2>

<p>لینک توویت: https://twitter.com/pykello_fa/status/1507248675491237893</p>

<p>اپراتور like در sql برای چک کردن فرمت یه رشته استفاده می‌شه. مثلا در شکل زیر سطر ۱ چک می‌کنه که آیا s با ab شروع می‌شه، و سطر ۲ چک می‌کنه که آیا یه جایی تو s زیررشته‌ی xyz وجود داره.</p>

<p> <img src="/img/peyk-5.png" alt="کد پیک‌نوروزی ۵" /></p>

<p>در زبان دلخواه‌تون تابعی بنویسین که یه رشته به شکل سطر ۴ بگیره و اگه text مطابق رشته‌ی template بود، True برگردونه وگرنه False. قوانین تطبیق:</p>

<ol>
 <li>٪: صفر یا بیشتر کاراکتر</li>
 <li>خط زیر(underscore): دقیقا یک کاراکتر</li>
 <li>در داخل رشته‌ها به جای <code>'</code> از دو تا <code>'</code> استفاده می‌کنیم (مثل مثال یکی مونده به آخر).</li></ol>

<p>دقت کنید که ورودی تابع یه رشته‌ی سرهمه، نه دو تا رشته. خودتون باید parse کنین.</p>

<p> <img src="/img/peyk-5b.png" alt="کد پیک‌نوروزی ۵" /></p>

<p>اگه دلتون خواست از regex استفاده کنین، اگه هم راحت بودین از اول تا تهش رو خودتون پیاده‌سازی کنین، یا اصلا از هر کتابخونه‌ای دلتون خواست استفاده کنین.</p>

<p>اگه این براتون آسون بود و خواستین نسخه‌ی کمی پیچیده‌ترش رو حل کنین، اینو حل کنین: <a href="https://acm.timus.ru/problem.aspx?space=1&amp;num=1177">Timus #1177</a></p>

<p>دقت کنید که اینو تو هر زبونی دلتون خواست می‌تونین بنویسین، مثلا پایتون، &hellip; ربطش به sql فقط صورت مساله‌است، لزومی نداره از sql استفاده کنین. اصلا برای جالب‌تر شدن بهتره از sql استفاده نکنین.</p>

<h3 id="پاسخ">پاسخ</h3>

<p>راه‌حل من برای سوال کامل‌تر (<a href="https://acm.timus.ru/problem.aspx?space=1&amp;num=1177">Timus #1177</a>) با استفاده از زبان هسکل: https://gist.github.com/pykello/536dcde060db18c892d5</p>

<h2 id="روز-۶-جایزههای-اسمولیان">روز ۶. جایزه‌های اسمولیان</h2>

<p>لینک توویت: https://twitter.com/pykello_fa/status/1507606717583933441</p>

<ol>
 <li>
  <p>سه تا جایزه‌ی الف و ب و ج داریم. شما قراره یه جمله بگین، اگه این جمله صحیح بود، یکی از جوایز الف یا ب رو می‌گیرین، وگرنه جایزه‌ی ج. شما میخواین حتما جایزه‌ی الف رو ببرین. چه جمله‌ای می‌تونین بگین که حتما جایزه‌ی الف رو ببرین؟</p></li>
 <li>
  <p>چهار جایزه‌ی الف و ب و ج و د داریم. این دفعه اگه جمله‌ای که میگین صحیح بود، الف یا ب رو می‌گیرین، اگه غلط بود ج یا د. شما میخواین حتما جایزه‌ی ج رو ببرین. چه جمله‌ای می‌تونین بگین که حتما این جایزه رو ببرین؟</p></li></ol>

<h3 id="پاسخ-و-بحث">پاسخ و بحث</h3>

<p>لینک توویت پاسخ: https://twitter.com/pykello_fa/status/1507856501137981449</p>

<p>توضیح علی‌بیگی برای بخش اول سوال:</p>

<center>
 <blockquote class="twitter-tweet" data-conversation="none">
  <p lang="fa" dir="rtl">عکس راه حل برای مساله اول <a href="https://twitter.com/hashtag/%D9%BE%DB%8C%DA%A9%E2%80%8C%D9%86%D9%88%D8%B1%D9%88%D8%B2%DB%8C?src=hash&amp;amp;ref_src=twsrc%5Etfw">#پیک‌نوروزی</a> <a href="https://t.co/TxfVWZ3yy0">pic.twitter.com/TxfVWZ3yy0</a></p>&mdash; Ali Baygi (@alibaygi) <a href="https://twitter.com/alibaygi/status/1507684712164306949?ref_src=twsrc%5Etfw">March 26, 2022</a></blockquote> 
 <script async="async" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></center>

<p>پاسخ بخش دوم سوال هم به طور مشابه می‌شود: «من جایزه‌ی د رو می‌برم»</p>

<p>این سوال جزو مساله‌های اول کتاب «to mock a mockingbird» ریموند اسمولیان بود. اگه به اینطور مساله‌ها علاقه دارین، بقیه کتاب رو بخونید.</p>

<p> <img src="/img/peyk-6.png" alt="کد پیک‌نوروزی ۶" /></p>

<h2 id="روز-۷-چاپ-همهی-درختهای-دودویی">روز ۷. چاپ همه‌ی درخت‌های دودویی</h2>

<p>لینک توویت: https://twitter.com/pykello_fa/status/1507968157901803520</p>

<p>در زبان دلخواهتون تابعی بنویسید که تمام درخت‌های دودویی (درجه‌ی هر گره ۱ یا ۲) با n گره رو تولید و با استفاده از o - | + چاپ کنه.</p>

<p> <img src="/img/peyk-7.jpg" alt="کد پیک‌نوروزی ۷" /></p>

<p>اگه حوصله‌ی این سوال رو ندارین، یه سوال مشابه کمی آسون‌تر ولی از همین جنس:</p>

<p>تابعی بنویسید که پرانتزبندی‌های مجاز با n پرانتز رو به دست بیاره:</p>

<p> <img src="/img/peyk-7b.png" alt="کد پیک‌نوروزی ۷" /></p>

<h3 id="پاسخ">پاسخ</h3>

<p>لینک توویت پاسخ: https://twitter.com/pykello_fa/status/1508291797742616576</p>

<ul>
 <li>کد من برای این مساله: <a href="https://replit.com/@HadiMoshayedi/BinaryTrees#main.py">BinaryTrees/main.py</a></li>
 <li>کد تمیزتر  <a href="https://twitter.com/behdadesfahbod">@behdadesfahbod</a>  برای این مساله: <a href="https://gist.github.com/behdad/762d3f8b00fb3cbeb7acd3deb23b5f37">behdad/print_trees.py</a></li>
 <li>کد من برای مساله‌ی پرانتزها: <a href="https://replit.com/@HadiMoshayedi/parentheses#main.py">parentheses/main.py</a></li></ul>

<h2 id="روز-۸-اختلاف-سرعت-sum1-و-sum2">روز ۸. اختلاف سرعت sum1 و sum2</h2>

<p>لینک توویت: https://twitter.com/pykello_fa/status/1508321695802617859</p>

<p>تابع sum1 و sum2 هر دو از لحاظ منطقی یک کار انجام می‌دهند، تمام اعضای آرایه‌ی دوبعدی data را جمع می‌کنند. با این تفاوت که sum1 سطر به سطر حرکت می‌کند و sum2 ستون به ستون.</p>

<p>چرا تابع sum1 حدود ۱۹ برابر سریع‌تر از تابع sum2 است؟</p>

<p> <img src="/img/peyk-8.jpg" alt="کد پیک‌نوروزی ۸" /></p>

<p>کامپایل و مقایسه‌ی سرعت در تصویر زیر (اگه تست کردید، شما هم از clang و فلگ O3 استفاده کنید).</p>

<p> <img src="/img/peyk-8b.png" alt="کد پیک‌نوروزی ۸" /></p>

<p>کد کامل در: <a href="https://gist.github.com/pykello/c453e0ba413932ccb7d09aa327b75aca">https://gist.github.com/pykello/c453e0ba413932ccb7d09aa327b75aca</a></p>

<p>توضیح: از دو حلقه‌ی تو در تو استفاده نکردم، چون کامپایلر اتوماتیک بهینه‌سازی می‌کرد و ترتیب حلقه‌ها را اتوماتیک جابجا می‌کرد و سرعت هر دو حالت یکی می‌شد.</p>

<h3 id="پاسخ-و-بحث">پاسخ و بحث</h3>

<p>لینک توویت پاسخ: https://twitter.com/pykello_fa/status/1508645489637421064</p>

<p>دلایل اصلی همانطور که خیلی‌ها اشاره کردند:</p>

<ol>
 <li>استفاده‌ی بهینه‌تر از کش سی‌پی‌یو</li>
 <li>استفاده از دستورالعمل‌های SIMD</li></ol>

<p>cpu چندین لایه کش دارد، که اندازه و تاخیر دسترسی (بر حسب کلاک) به لایه‌های مختلف cpu من را می‌بینید.</p>

<p>همانطور که می‌بینید، دسترسی به L1 ده برابر سریع‌تر از L3 است که آن نیز چند برابر سریع‌تر از دسترسی مستقیم به RAM است.</p>

<p> <img src="/img/peyk-8c.png" alt="کد پیک‌نوروزی ۸" /></p>

<p>نکته‌ای که وجود دارد این است که واحد کش شدن ۶۴ بایت است، و شما اگر یک خانه‌ی ۴ بایتی هم بخوانید، مثل data[0][0]، پانزده خانه‌ی بعدی نیز کش خواهند شد و ۱۵ عمل بعدی همه از کش خواهند خواند.</p>

<p>وقتی داده‌ها را سطربه‌سطر پردازش می‌کنیم، به احتمال زیاد هر ۱۶ عدد یک بار نیاز داریم بالاتر از L1 دسترسی پیدا کنیم، ولی در پردازش ستون‌به‌ستون، با توجه به سایز محدود L1 (۳۲ کیلوبایت)، کلی از مقادیر کش شده بدون استفاده دور ریخته می‌شوند.</p>

<p>در تصویر تعداد دسترسی‌ها به L3 (=LLC) را در هر ۲ تابع می‌بینید.</p>

<p> <img src="/img/peyk-8d.png" alt="کد پیک‌نوروزی ۸" /></p>

<p>همانطور که می‌بینید، در sum1 تعداد دسترسی‌ها به L3 بسیار کم است، چون اکثر مقدارها در L1 و L2 پاسخ داده شده‌اند. ولی در sum2 اکثر مقادیر از L1 و L2 یافت نشدند و به L3 رسیدند که بعضی از آن‌ها نیز از RAM خوانده شده.</p>

<p>نکته‌ی ۲ این است که به علت پشت سر هم بودن مقادیر جمع شده در حافظه در sum1، کامپایلر از دستورالعمل‌هایی استفاده می‌کند که در یک حرکت چندین عدد را با هم جمع می‌کنند. برای آشنایی با این دستورالعمل‌ها به لینک زیر مراجعه کنید: <a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">Single_instruction,_multiple_data</a></p>
  <footer>
    <script type="text/javascript">
      !function(d,s,id){
          var js,fjs=d.getElementsByTagName(s)[0];
          if(!d.getElementById(id)){
              js=d.createElement(s);
              js.id=id;
              js.src="//platform.twitter.com/widgets.js";
              fjs.parentNode.insertBefore(js,fjs);
          }
      }(document,"script","twitter-wjs");
    </script>
    <a href="https://twitter.com/share"
       class="twitter-share-button"
       data-url="http://pykello.github.com/fa//fa/2022/05/%D9%BE%DB%8C%DA%A9-%D9%86%D9%88%D8%B1%D9%88%D8%B2%DB%8C-%DB%B1%DB%B4%DB%B0%DB%B1-%D8%B1%D9%88%D8%B2%D9%87%D8%A7%DB%8C-%DB%B5-%D8%AA%D8%A7-%DB%B8.html"
       data-dnt="true">
      "Tweet"</a>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.identifier = undefined;
        this.page.url = undefined;
        this.page.title = undefined;
        this.page.category_id = undefined;
      };
      var disqus_shortname = 'pykello';
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          dsq.setAttribute('data-timestamp', +new Date());
          (document.head || document.body).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </footer>
</article>
        </main>
        <footer>
            <hr />
            <p><a href="https://twitter.com/pykello"
                  class="twitter-follow-button"
                  data-show-count="false"
                  data-lang="en">
                 "Follow Hadi Moshayedi"
               </a>
               <script type="text/javascript">
                 !function(d,s,id){
                     var js,fjs=d.getElementsByTagName(s)[0];
                     if(!d.getElementById(id)){
                         js=d.createElement(s);
                         js.id=id;
                         js.src="//platform.twitter.com/widgets.js";
                         fjs.parentNode.insertBefore(js,fjs);
                     }
                 }(document,"script","twitter-wjs");
               </script></p>
          </footer>
    </div>
  </body>
</html>