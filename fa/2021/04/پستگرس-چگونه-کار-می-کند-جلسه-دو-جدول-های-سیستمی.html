<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>ูพุณุชฺฏุฑุณ ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏุ ุฌูุณู ุฏู - ุฌุฏููโูุง ุณุณุชู</title>
    <meta name="description" content="ุฏุฑ ุฌูุณู ฺฉ ฺฏูุชู ฺฉู ูพุณุชฺฏุฑุณ ูพุณ ุงุฒ parse ฺฉุฑุฏู ฺฉูุฆุฑุ ุฏุฑ ูุฑุญูู ุขูุงูุฒ ุงุฑุฌุงุนุงุช ุจู ุฌุฏุงููุ ุณุชููโูุงุ  ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ.  ูุซูุง ุฏุฑ ฺฉูุฆุฑ ุฒุฑ:  `SELECT a, b FROM t WHERE a > 0;` ุจุงุฏ ุงุฑุฌุงุนุงุช ุฒุฑ ุจุฑุฑุณ ุดููุฏ:   ุขุง ุฌุฏูู ุจู ูุงู t ูุฌูุฏ ุฏุงุฑุฏุ ุฏุฑ ุตูุฑุช ูุฌูุฏุ ูุฑุงุฏุงุฏูโ ูุฑุจ...">
    <meta name="author"      content="ูุงุฏ ูุดุฏ">
    <meta name="keywords"    content="ูพุณุชฺฏุฑุณ">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/fa/favicon.svg">
    <link rel="canonical" href="http://pykello.github.com/fa//fa/2021/04/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%DA%86%DA%AF%D9%88%D9%86%D9%87-%DA%A9%D8%A7%D8%B1-%D9%85%DB%8C-%DA%A9%D9%86%D8%AF-%D8%AC%D9%84%D8%B3%D9%87-%D8%AF%D9%88-%D8%AC%D8%AF%D9%88%D9%84-%D9%87%D8%A7%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85%DB%8C.html">
    <link rel="next" href="/fa/2021/04/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%DA%86%DA%AF%D9%88%D9%86%D9%87-%DA%A9%D8%A7%D8%B1-%D9%85%DB%8C-%DA%A9%D9%86%D8%AF-%D8%AC%D9%84%D8%B3%D9%87-%DB%8C%DA%A9-%D8%B2%D9%86%D8%AF%DA%AF%DB%8C-%DB%8C%DA%A9-%DA%A9%D9%88%D9%8A%D9%94%D8%B1%DB%8C.html">
    <link rel="prev" href="/fa/2021/06/%D8%A8%D9%87%DB%8C%D9%86%D9%87-%D8%B3%D8%A7%D8%B2-%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%D8%A8%D8%AE%D8%B4-%DB%8C%DA%A9%D9%85.html">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/fa/css/monochrome.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/custom.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/fa/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/fa/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>

    <!-- Header -->

    <header id="header" class="parent justify-spaceBetween">
      <div class="inner w100 relative">
        <span class="f-left">
          <a href="/fa">
            <h1>
              <span>the</span>lost<span>packet</span>
            </h1>
          </a>
        </span>
      </div>
    </header>

    <div id="container">
        <main>
            <article>
  <header>
    <h1>ูพุณุชฺฏุฑุณ ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏุ ุฌูุณู ุฏู - ุฌุฏููโูุง ุณุณุชู</h1>
    <p class='date-and-tags'>
<time datetime="2021-04-18" pubdate="true">2021-04-18</time> :: <span class="tags"><a href="/fa/tags/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3.html">ูพุณุชฺฏุฑุณ</a></span></p>
    <p class='authors'><span class="authors">ูุงุฏ ูุดุฏ</span></p>
  </header>

<p>ุฏุฑ <a href="/fa/2021/04/ูพุณุชฺฏุฑุณ-ฺฺฏููู-ฺฉุงุฑ-ู-ฺฉูุฏ-ุฌูุณู-ฺฉ-ุฒูุฏฺฏ-ฺฉ-ฺฉูููุฑ.html">ุฌูุณู ฺฉ</a> ฺฏูุชู ฺฉู ูพุณุชฺฏุฑุณ ูพุณ ุงุฒ parse ฺฉุฑุฏู ฺฉูุฆุฑุ ุฏุฑ ูุฑุญูู ุขูุงูุฒ ุงุฑุฌุงุนุงุช ุจู ุฌุฏุงููุ ุณุชููโูุงุ &hellip; ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ.</p>

<p>ูุซูุง ุฏุฑ ฺฉูุฆุฑ ุฒุฑ:</p>

<pre><code>SELECT a, b FROM t WHERE a &gt; 0;</code></pre>

<p>ุจุงุฏ ุงุฑุฌุงุนุงุช ุฒุฑ ุจุฑุฑุณ ุดููุฏ:</p>

<ol>
 <li>ุขุง ุฌุฏูู ุจู ูุงู t ูุฌูุฏ ุฏุงุฑุฏุ ุฏุฑ ุตูุฑุช ูุฌูุฏุ ูุฑุงุฏุงุฏูโ ูุฑุจูุท ุจู t (ูุซู ูุณุฑ ูุงู ุฏุงุฏู) ฺุณุชุ</li>
 <li>ุขุง ุฌุฏูู t ุณุชููโูุง ุจู ูุงู a ู b ุฏุงุฑุฏุ ุฏุฑ ุตูุฑุช ูุฌูุฏุ ุงู ุณุชููโูุง ฺูุฏูู ุณุชููโูุง ุฏุฑ ุงู ุฌุฏูู ูุณุชูุฏุ</li>
 <li>ููุน ุฏุงุฏูโูุง ุณุชููโูุง a ู b ฺุณุชุ</li>
 <li>ูุฑุถ ฺฉูุฏ ููุน ุณุชูู a ุนุฏุฏ ุตุญุญ ุงุณุช. ุขุง ุนูู <code>a &gt; 0</code> ุจุฑุง ุงุนุฏุงุฏ ุตุญุญ ุชุนู ุดุฏู ุงุณุชุ ุงฺฏุฑ ุจูุ ุจุฑุง ุงูุฌุงู ุงู ุนูู ุจุงุฏ ุงุฒ ฺู ุชุงุจุน ุจุงุฏ ุงุณุชูุงุฏู ุดูุฏุ</li></ol>

<p>ุฏุฑ ุงู ุจุฎุด ุจู ุงู ูโูพุฑุฏุงุฒู ฺฉู ูพุณุชฺฏุฑุณ ฺฺฏููู ุจู ุณูุงูโูุง ุจุงูุง ูพุงุณุฎ ูโุฏูุฏ.</p>

<p>ููฺฉ ูุฏุฆู: <a href="https://youtu.be/hHkubRh-LXw">youtu.be/hHkubRh-LXw</a></p>
<!-- more-->

<h3 id="ูพุดูุงุฒูุง">ูพุดโูุงุฒูุง</h3>

<p>ุจุฑุง ุฏูุจุงู ฺฉุฑุฏู ุงู ุจุฎุด ูุงุฒ ูุฏุงุฑุฏ <a href="/fa/2021/04/ูพุณุชฺฏุฑุณ-ฺฺฏููู-ฺฉุงุฑ-ู-ฺฉูุฏ-ุฌูุณู-ฺฉ-ุฒูุฏฺฏ-ฺฉ-ฺฉูููุฑ.html">ุฌูุณู ฺฉ</a> ุฑุง ุฎูุงูุฏู ุจุงุดุฏ.</p>

<p>ูู ูุงุฒ ุฏุงุฑุฏ ฺฉู ูพุณุชฺฏุฑุณ ุฑุง ฺฉุงููพุงู ู ูุตุจ ฺฉุฑุฏู ุจุงุดุฏ. ฺฏุงูโูุง ูุงุฒู ุจุฑุง ุงู ุงูุฑ ุฑุง ุฏุฑ  <a href="/fa/2020/05/ูพุณุชฺฏุฑุณ-ฺฺฏููู-ฺฉุงุฑ-ู-ฺฉูุฏ-ุฌูุณู-ุตูุฑ.html">ุงู ููุงูู</a> ุขูุฑุฏูโุงู.</p>

<h2 id="ูุฑุงุฏุงุฏู-ุฌุฏูู-pgclass">ูุฑุงุฏุงุฏูโ ุฌุฏูู: pg_class</h2>

<p>ูุฑุงุฏุงุฏูโ ูุฑุจูุท ุจู ุฌุฏููโูุง ุฏุฑ ุฌุฏูู ุณุณุชู pg_class ูุฑุงุฑ ุฏุงุฑุฏ. ูุซูุง ุจุฑุง ุงูฺฉู ูุฑุงุฏุงุฏู ุฌุฏูู ุจู ูุงู t ุฑุง ุจุจููุ ูโุชูุงูู ุงุฒ ฺฉูุฆุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูู. ุจุฎุดโูุง ุงุฒ ุฎุฑูุฌ ุฑุง ุฏุฑ ุฒุฑ ูโุจูุฏ:</p>

<pre><code>postgres=# SELECT * FROM pg_class WHERE relname='t';
-[ RECORD 1 ]-------+------
oid                 | 16394
relname             | t
...
relfilenode         | 16394
...
relkind             | r
relnatts            | 2
...</code></pre>

<p>ุฏุฑ ุฎุฑูุฌ ุจุงูุง:</p>

<ul>
 <li>ููุฏุงุฑ relname ูุงู ุฌุฏูู ุงุณุช.</li>
 <li>ููุฏุงุฑ oid ุดูุงุฑู ุฏุงุฎู ุฌุฏูู ุงุณุช. ุฏุฑ ุขูุฏู ุฎูุงูู ุฏุฏ ฺฉู ุงู ุดูุงุฑู ุฏุฑ ุฌุฏููโูุง ุณุณุชู ุฏฺฏุฑ (ูุซูุง ุฌุฏูู ูุฑุจูุท ุจู ุณุชููโูุง) ุจุฑุง ุงุดุงุฑู ุจู ุฌุฏูู ุงุณุชูุงุฏู ูโุดูุฏ.</li>
 <li>ููุฏุงุฑ relkind ูุดุงู ูโุฏูุฏ ฺฉู ุงู ุฑฺฉูุฑุฏ ุฏุฑ pg_class ุฏุฑ ูุงูุน ูุฑุจูุท ุจู ฺฉ ุฌุฏูู ุงุณุช. ุฌุฏูู ุณุณุชู pg_class ูโุชูุงูุฏ ุดุงูู ูุฑุงุฏุงุฏู ุงูุฏฺฉุณุ viewุ &hellip; ูุฒ ุจุงุดุฏ ฺฉู ุจุฑุง ุขู ููุงุฑุฏ ููุฏุงุฑ relkind ูุชูุงูุช ุฎูุงูุฏ ุจูุฏ.</li>
 <li>ููุฏุงุฑ relnatts ุชุนุฏุงุฏ ุณุชููโูุง ุฌุฏูู ุฑุง ูุดุงู ูโุฏูุฏ.</li></ul>

<h4 id="relfilenode">relfilenode</h4>

<p>ุฏุฑ ุฎุฑูุฌ ุจุงูุง ููุฏุงุฑ relfilenode ูุงู ูุงู ุงุณุช ฺฉู ุฏุฑ ุฏุณฺฉ ุจุฑุง ุฐุฎุฑู ุงุทูุงุนุงุช ุฌุฏูู t ุงุณุชูุงุฏู ุดุฏู ุงุณุช. ูุณุฑ ฺฉุงูู ูุงู ุงุฒ ูุฑููู ุฒุฑ ุจู ุฏุณุช ูโุขุฏ:</p>

<pre><code>$PGDATA/base/$database_id/$relfilenode</code></pre>

<p>ฺฉู <code>$PGDATA</code> ูุณุฑ ุฏุงุฑฺฉุชูุฑ ฺฉูุงุณุชุฑ ูพุณุชฺฏุฑุณ ุงุณุช. ุงุณู ุงู ุฏุงุฑฺฉุชูุฑ ุฑุง ูููุน ุงุฌุฑุง initdb ุงูุชุฎุงุจ ฺฉุฑุฏุฏ. ุงฺฏุฑ ูุณุฑ ุงู ุฏุงุฑฺฉุชูุฑ ุฑุง ูุฑุงููุด ฺฉุฑุฏูโุงุฏุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ูโุชูุงูุฏ ุงุณุชูุงุฏู ฺฉูุฏ:</p>

<pre><code>postgres=# show data_directory;
-[ RECORD 1 ]--+----------------
data_directory | /home/hadi/data</code></pre>

<p><code>$database_id</code> ุดูุงุฑู ุฏุงุฎู ุฏุชุงุจุณ ุงุณุช. ุงุณู ุฏุชุงุจุณ ฺฉู ูุง ุงุณุชูุงุฏู ูโฺฉูู postgres ุงุณุช. ุจุฑุง ุงูุชู ุดูุงุฑู ุขู ูโุชูุงูุฏ ุงุฒ ุฌุฏูู pg_class ุงุณุชูุงุฏู ฺฉูุฏ:</p>

<pre><code>postgres=# select oid from pg_database where datname='postgres';
  oid
-------
 12675
(1 row)</code></pre>

<p>ูพุณ ุจุฑุง ุฌุฏูู ุจุงูุง ูุณุฑ ูุงู ูุฑุจูุท ุจู ุฌุฏูู tุ ุฎูุงูุฏ ุจูุฏ: <code>/home/hadi/data/base/12675/16394</code>.</p>

<p>ุจุฑุง ุขุณุงูุ ูโุชูุงูุฏ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ูุฒ ุจุฑุง ุงูุชู ูุณุฑ ูุงู ุงุณุชูุงุฏู ฺฉูุฏ:</p>

<pre><code>postgres=# SELECT pg_relation_filepath('t');
 pg_relation_filepath
----------------------
 base/12675/16394
(1 row)</code></pre>

<h4 id="ุขุง-relfilenode-ููุดู-ุจุง-ุดูุงุฑู-ุฌุฏูู-ฺฉุณุงู-ุงุณุช">ุขุง relfilenode ููุดู ุจุง ุดูุงุฑู ุฌุฏูู ฺฉุณุงู ุงุณุชุ</h4>

<p>ุฏุฑ ุฎุฑูุฌ ุจุงูุง ุฏุฏู ฺฉู ูู ุดูุงุฑู ุฌุฏูู (oid) ู ูู relfilenode ฺฉุณุงู ู ุจุฑุงุจุฑ ุจุง 16394 ุจูุฏูุฏ. ููุฏุงุฑ ุงููู ุงู ุฏู ฺฉุณุงู ุงุณุช. ููุฏุงุฑ ุดูุงุฑู ุฌุฏูู ูฺโฺฏุงู ุชุบุฑ ููโฺฉูุฏุ ูู ุจุฑุฎ ุฏุณุชูุฑุงุช ูุณุชูุฏ ฺฉู ููฺฉู ุงุณุช relfilenode ุฑุง ุชุบุฑ ุฏููุฏ. ูุซูุง ุฏุณุชูุฑ TRUNCATE ฺฉู ุชูุงู ุณุทุฑูุง ฺฉ ุฌุฏูู ุฑุง ุญุฐู ูโฺฉูุฏ:</p>

<pre><code>postgres=# truncate t;
TRUNCATE TABLE
postgres=# select oid, relfilenode from pg_class where relname='t';
  oid  | relfilenode
-------+-------------
 16394 |       24586
(1 row)</code></pre>

<p>ูพุงุฏูโุณุงุฒ ุฏุงุฎู TRUNCATE ุงุจุชุฏุง ฺฉ ูุงู ุฎุงู ุจุง ูุงู relfilenode ุฌุฏุฏ ุงุฌุงุฏ ูโฺฉูุฏุ ุณูพุณ ููุฏุงุฑ relfilenode ุฑุง ุฏุฑ pg_class ุชุบุฑ ูโุฏูุฏุ ู ุณูพุณ ูุงู ูุฏู ุฑุง ูพุงฺฉ ูโฺฉูุฏ.</p>

<h4 id="ููุงุจุน-ุจุดุชุฑ">ููุงุจุน ุจุดุชุฑ</h4>

<ul>
 <li><a href="https://www.postgresql.org/docs/current/catalog-pg-class.html">ุงุทูุงุนุงุช ฺฉุงูู ุฏุฑุจุงุฑู pg_class</a></li>
 <li><a href="https://github.com/postgres/postgres/blob/091e22b2e673e3e8480abd68fbb827c5d6979615/src/backend/utils/cache/relcache.c#L3576">ฺฉุฏ ุชุบุฑ relfilenode</a></li></ul>

<h2 id="ูุฑุงุฏุงุฏู-ุณุชูููุง-pgattribute">ูุฑุงุฏุงุฏู ุณุชููโูุง: pg_attribute</h2>

<p>ุงูฺฉู ุฌุฏูู ฺู ุณุชููโูุง ุฏุงุฑุฏ ู ููุน ุขู ุณุชููโูุง ฺุณุช ุฑุง ูโุชูุงูู ุจุง ุงุณุชูุงุฏู ุงุฒ ุฌุฏูู ุณุณุชู pg_attribute ุจู ุฏุณุช ุจุงูุฑู.</p>

<p>ุจู ุงุฒุง ูุฑ ุณุชูู ุฌุฏูู ุฏุฑ pg_attribute ฺฉ ุณุทุฑ ูุฌูุฏ ุฏุงุฑุฏ. ุนูุงูู ุจุฑ ุงู ูุฑ ุฌุฏูู ฺฉ ุณุฑ ุณุชููโูุง ุณุณุชู ูุงููุฏ cmax, xmax, cmin, xmin, &hellip; ุฏุงุฑุฏ ฺฉู ุจู ุงุฒุง ุขูโูุง ูุฒ ฺฉ ุณุฑ ุฏุฑ pg_attribute ูุฌูุฏ ุฏุงุฑุฏ.</p>

<p>ุจู ุงู ุณุชููโูุง ุณุณุชู ุฏุฑ ุฌูุณุงุช ุขูุฏู ุฎูุงูู ูพุฑุฏุงุฎุช.</p>

<p>ุจุฑุง ุงูฺฉู ุชููุง ุงุทูุงุนุงุช ูุฑุจูุท ุจู ุณุชููโูุง ุบุฑ ุณุณุชู ุฌุฏูู ุฑุง ุจุจููุ ุดุฑุท <code>attnum &gt; 0</code> ุฑุง ุจู ฺฉูุฆุฑ ุฒุฑ ุงุถุงูู ูโฺฉูู:</p>

<pre><code>postgres=# select * from pg_attribute where attrelid = 16394 and attnum &gt; 0;</code></pre>

<p>ุฏุฑ ฺฉูุฆุฑ ุจุงูุง ูุฑุถ ุดุฏู ุงุณุช ฺฉู ุดูุงุฑู ุฌุฏูู t ุจุฑุงุจุฑ ุจุง 16394 ุงุณุช. ููุฏุงุฑ ุขู ุฑุง ุฏุฑ ุจุงูุง ุงุฒ pg_class ุจู ุฏุณุช ุขูุฑุฏู.</p>

<p>ุฎุฑูุฌ ฺฉูุฆุฑ ุจุงูุง ุฎูุงูุฏ ุจูุฏ:</p>

<pre><code>-[ RECORD 1 ]--+------
attrelid       | 16394
attname        | a
atttypid       | 23
...
attnum         | 1
...
attisdropped   | f
...
-[ RECORD 2 ]--+------
attrelid       | 16394
attname        | b
atttypid       | 23
...
attnum         | 2
...
attisdropped   | f
...</code></pre>

<p>ุงุฒ ุฌููู ุงุทูุงุนุงุช ฺฉู ุฏุฑ ุฎุฑูุฌ ุจุงูุง ูโุจูู:</p>

<ol>
 <li>ุดูุงุฑู ุชุฑุชุจ ูุฑ ุณุชูู (attnum)</li>
 <li>ุงุณู ุณุชูู (attname)</li>
 <li>ุงูฺฉู ุขุง ุณุชูู ุญุฐู ุดุฏู ุงุณุช ุง ูู (attisdropped)</li></ol>

<h4 id="ุญุฐู-ฺฉุฑุฏู-ฺฉ-ุณุชูู">ุญุฐู ฺฉุฑุฏู ฺฉ ุณุชูู</h4>

<p>ูุซูุง ูุฑุถ ฺฉูุฏ ฺฉู ุฏู ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูู ุชุง ฺฉ ุณุชูู ุญุฐู ุดูุฏ ู ฺฉ ุณุชูู ุงุถุงูู ุดูุฏ:</p>

<pre><code>ALTER TABLE t DROP COLUMN b;
ALTER TABLE t ADD COLUMN c text;</code></pre>

<p>ุงุทูุงุนุงุช ุณุชููโูุง ุจู ุตูุฑุช ุฒุฑ ุชุบุฑ ุฎูุงูุฏ ฺฉุฑุฏ:</p>

<pre><code>postgres=# select attname, attnum, attisdropped from pg_attribute where attrelid = 16394 and attnum &gt; 0;
-[ RECORD 1 ]+-----------------------------
attname      | a
attnum       | 1
attisdropped | f
-[ RECORD 2 ]+-----------------------------
attname      | ........pg.dropped.2........
attnum       | 2
attisdropped | t
-[ RECORD 3 ]+-----------------------------
attname      | c
attnum       | 3
attisdropped | f</code></pre>

<p>ููุงูุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏ ููุฏ attisdropped ุณุชูู ุฏูู ุจู ููุฏุงุฑ true ุชุบุฑ ฺฉุฑุฏ ู ุงุณู ุขู ูุฒ ุชุบุฑ ฺฉุฑุฏ.</p>

<p>ุจู ุงูฺฉู ฺุฑุง ุงู ุณุชูู ฺฉูุง ุญุฐู ูุดุฏ ุฏุฑ ุฌูุณุงุช ุขูุฏู ุฎูุงูู ูพุฑุฏุงุฎุช.</p>

<h4 id="ููุงุจุน-ุจุดุชุฑ">ููุงุจุน ุจุดุชุฑ</h4>

<ul>
 <li><a href="https://www.postgresql.org/docs/current/catalog-pg-attribute.html">ุงุทูุงุนุงุช ฺฉุงูู ุฏุฑุจุงุฑู pg_attribute</a></li></ul>

<h2 id="ูุฑุงุฏุงุฏู-ููุนูุง-pgtype">ูุฑุงุฏุงุฏู ููุนโูุง: pg_type</h2>

<p>ุงฺฉููู ฺฉู ุจุง ุงุณุชูุงุฏู ุงุฒ pg_attribute ุดูุงุฑู ููุน ุณุชููโูุง ุฑุง ุจุฏุณุช ุขูุฑุฏูุ ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ  ุฌุฏูู ุณุณุชู pg_type ุจู ุฌุฒุงุช ููุนโูุง ูฺฏุงู ฺฉูู.</p>

<p>ูุซูุง ุฏุฑ ูุซุงู ูุจู ููุน ุณุชูู a ุดูุงุฑู 23 ุฏุงุดุช. ุจุฑุง ูุดุงูุฏู ุงุทูุงุนุงุช ุงู ููุน ุงุฒ ฺฉูุฆุฑ ุฒุฑ ุงุณุชูุงุฏู ูโฺฉูู:</p>

<pre><code>postgres=# SELECT * FROM pg_type WHERE oid=23;
-[ RECORD 1 ]--+---------
oid            | 23
typname        | int4
...
typlen         | 4
...
typinput       | int4in
typoutput      | int4out
...</code></pre>

<p>ฺฉู ุงุทูุงุนุงุช ูุงููุฏ ุงุณู ููุน (typname)ุ ุทูู ฺฉ ููุฏุงุฑ ุงุฒ ุงู ููุน (typlen)ุ ุชุงุจุน ุชุจุฏู ุฑุดุชู ุจู ุงู ููุน (int4in)ุ ู ุชุงุจุน ุชุจุฏู ุงู ููุน ุจู ุฑุดุชู (int4out) ุฑุง ุจู ูุง ูุฏูุฏ.</p>

<h4 id="ููุงุจุน-ุจุดุชุฑ">ููุงุจุน ุจุดุชุฑ</h4>

<ul>
 <li><a href="https://www.postgresql.org/docs/current/catalog-pg-type.html">ุงุทูุงุนุงุช ฺฉุงูู ุฏุฑุจุงุฑู pg_type</a></li></ul>

<h2 id="ูุฑุงุฏุงุฏู-ุนููฺฏุฑูุง-ู-ุชูุงุจุน-pgoperator-ู-pgproc">ูุฑุงุฏุงุฏู ุนููฺฏุฑูุง ู ุชูุงุจุน: pg_operator ู pg_proc</h2>

<p>ุจุฑุง ุงูฺฉู ุจูููู ููุงุณู <code>a &gt; 0</code> ุฏุฑ ูุซุงู ฺฉู ุฏุฑ ุจุงูุง ุฒุฏู ฺฺฏููู ุจุงุฏ ุงุฌุฑุง ฺฉููุ ูุฑุงุญู ุฒุฑ ุฑุง ุงูุฌุงู ูโุฏูู:</p>

<ol>
 <li>ุจุง ุงุณุชูุงุฏู ุงุฒ pg_operator ุนููฺฏุฑ ฺฉู ููุงุฏุด <code>&gt;</code> ุงุณุช ู ุฏู ุนุฏุฏ ุตุญุญ ุฑุง ููุงุณู ูโฺฉูุฏ ุฑุง ูพุฏุง ูโฺฉูู</li>
 <li>ุงุฒ ุฑฺฉูุฑุฏ pg_operator ุงุณู ุชุงุจุน ฺฉู ุงู ุนูู ุจู ุฏุณุช ูโุขูุฑู.</li>
 <li>ุฏุฑ pg_proc ุชุงุจุน ฺฉู ุฏุฑ ูุฑุญูู ฒ ุงูุชู ุฑุง ูพุฏุง ูโฺฉูู. ุฑฺฉูุฑุฏ ูุฑุชุจุท ุฏุฑ pg_proc ุงุทูุงุนุงุช ฺฉุงู ุจุฑุง ุงุฌุฑุง ุชุงุจุน ุฑุง ุฏุงุฑุฏ.</li></ol>

<p>ูุซูุง ููุน ุนุฏุฏ ุตุญุญ ด ุจุงุช ุฏุฑ ูุซุงู ูุจู ุฏุงุฑุง ุดูุงุฑู 23 ุจูุฏ. ุจุฑุง ุงูุชู ุนูู ููุงุณู ุฏู ุนุฏุฏ ุตุญุญ:</p>

<pre><code>postgres=# select * from pg_operator where oprname='&lt;' and oprleft=23 and oprright=23;
-[ RECORD 1 ]+----------------
oid          | 97
oprname      | &lt;
...
oprleft      | 23
oprright     | 23
oprresult    | 16
...
oprcode      | int4lt
...</code></pre>

<p>ุงุฒ ุฎุฑูุฌ ุจุงูุง ููููู ฺฉู ุฎุฑูุฌ ุงู ุนููฺฏุฑ ุฏุงุฑุง ููุน 16 ุง ูููู ุจููู ุงุณุช ู ุงุณู ุชุงุจุน ฺฉู ุงู ุนููฺฏุฑ ุฑุง ุงุฌุฑุง ูโฺฉูุฏ int4lt ุงุณุช.</p>

<p>ุจุฑุง ุงูุชู ุงุทูุงุนุงุช ูุฑุจูุท ุจู int4lt:</p>

<pre><code>postgres=# select * from pg_proc where proname='int4lt';
-[ RECORD 1 ]---+-------
oid             | 66
proname         | int4lt
...
prolang         | 12
...
proargtypes     | 23 23
...
prosrc          | int4lt
...</code></pre>

<p>ุฏุฑ ุฎุฑูุฌ ุจุงูุง ุฐฺฉุฑ ุดุฏู ุงุณุช ฺฉู ุฒุจุงู ุงู ุชุงุจุน 12 ุงุณุช. ุจุฑุง ุงูุชู ุงุทูุงุนุงุช ูุฑุจูุท ุจู ุฒุจุงู 12:</p>

<pre><code>postgres=# select * from pg_language where oid=12;
-[ RECORD 1 ]-+---------
oid           | 12
lanname       | internal
...</code></pre>

<p>ุงุฒ ฺฉูุงุฑ ฺฏุฐุงุดุชู ุฏู ุฎุฑูุฌ ุงุฎุฑ ููููู ฺฉู int4lt ฺฉ ุชุงุจุน ุฏุงุฎู ุฏุฑ ุณูุฑุณ ฺฉุฏ ูพุณุชฺฏุฑุณ ุงุณุช.</p>

<p>ุงู ุชุงุจุน ุฏุงุฎู ุฏุฑ <a href="https://github.com/postgres/postgres/blob/c30f54ad732ca5c8762bb68bbe0f51de9137dd72/src/backend/utils/adt/int.c#L393">postgres/src/backend/utils/adt/int.c</a> ูุชูุงูุฏ ุจุงุจุฏ.</p>

<h4 id="ููุงุจุน-ุจุดุชุฑ">ููุงุจุน ุจุดุชุฑ</h4>

<ul>
 <li><a href="https://www.postgresql.org/docs/current/catalog-pg-operator.html">ุงุทูุงุนุงุช ฺฉุงูู ุฏุฑุจุงุฑู pg_operator</a></li>
 <li><a href="https://www.postgresql.org/docs/current/catalog-pg-proc.html">ุงุทูุงุนุงุช ฺฉุงูู ุฏุฑุจุงุฑู pg_proc</a></li></ul>

<h2 id="ูุซุงู">ูุซุงู</h2>

<p>ุจุง ฺุฒูุง ฺฉู ุฏุฑ ุงู ุฌูุณู ุงุฏฺฏุฑูุชูุ ูโุฎูุงูู ฺฉ ุชุงุจุน ุจููุณู ฺฉู ุงุณู ุฌุฏูู ุฑุง ุจู ุตูุฑุช ฺฉ ุฑุดุชู ูุชู ุจฺฏุฑุฏ ู ุฏุณุชูุฑ CREATE TABLE ุขู ุฑุง ุจู ุตูุฑุช ุฑุดุชู ูุชู ุฎุฑูุฌ ุฏูุฏ.</p>

<p>ุฏุฑ ูุฏุฆู ุจู ุทูุฑ ฺฉุงูู ุงู ุฑุง ุชูุถุญ ุฏุงุฏู. ูุชุฌู ููุง ุนุจุงุฑุช ุจูุฏ ุงุฒ:</p>

<div class="brush: sql">
 <table class="sourcetable">
  <tbody>
   <tr>
    <td class="linenos">
     <div class="linenodiv">
      <pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td>
    <td class="code">
     <div class="source">
      <pre><span></span><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">table_name_to_create_table</span><span class="p">(</span><span class="k">table_name</span> <span class="nb">text</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="nb">text</span>
<span class="k">AS</span> <span class="err">$$</span>
  <span class="k">SELECT</span> <span class="s1">&#39;CREATE TABLE &#39;</span> <span class="o">||</span> <span class="n">relname</span> <span class="o">||</span> <span class="s1">&#39;(&#39;</span> <span class="o">||</span>
         <span class="n">string_agg</span><span class="p">(</span><span class="n">attname</span> <span class="o">||</span> <span class="s1">&#39; &#39;</span> <span class="o">||</span> <span class="n">typname</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;)&#39;</span>
  <span class="k">FROM</span> <span class="n">pg_type</span><span class="p">,</span> <span class="n">pg_class</span><span class="p">,</span> <span class="n">pg_attribute</span>
  <span class="k">WHERE</span> <span class="n">relname</span><span class="o">=</span><span class="k">table_name</span> <span class="k">and</span>
        <span class="n">pg_class</span><span class="p">.</span><span class="n">oid</span><span class="o">=</span><span class="n">pg_attribute</span><span class="p">.</span><span class="n">attrelid</span> <span class="k">and</span>
        <span class="n">attnum</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">and</span> <span class="k">not</span> <span class="n">attisdropped</span> <span class="k">and</span>
        <span class="n">pg_type</span><span class="p">.</span><span class="n">oid</span><span class="o">=</span><span class="n">atttypid</span>
  <span class="k">group</span> <span class="k">by</span> <span class="n">relname</span><span class="p">;</span>
<span class="err">$$</span> <span class="k">LANGUAGE</span> <span class="k">sql</span><span class="p">;</span>
</pre></div>
</td></tr></tbody></table>
</div>

<p>ุจุฑุง ุฌุฒุฆุงุช ุจู ูุฏุฆู ูุฑุงุฌุนู ฺฉูุฏ.</p>

<h2 id="ุชฺฉูู-ฺฉุงุฑ-ุฏุฑ-ุฎุงูู-">ุชฺฉูู ฺฉุงุฑ ุฏุฑ ุฎุงูู ๐</h2>

<p>ุซุงู ุฑุง ุชุบุฑ ุฏูุฏ ุชุง ุจุง ุงุณุชูุงุฏู ุงุฒ ููุฏ attnotnull ุฌุฏูู pg_attribute ุจุฑุง ูุฑ ุณุชูู NOT NULL ุง NULL ุฏุฑุณุช ุฑุง ุงุถุงูู ฺฉูุฏ.</p>

<p>ูุซูุง ุงฺฏุฑ ุฌุฏูู ุจู ุตูุฑุช ุฒุฑ ุงุฌุงุฏ ุดุฏู ุจุงุดุฏุ</p>

<pre><code>CREATE TABLE t(a int NOT NULL, b int);</code></pre>

<p>ุฎุฑูุฌ ุชุงุจุน ฺฉู ุฏุฑ ุจุฎุด ูุซุงู ููุดุชู ูุดุฎุตู NOT NULL ุณุชูู ุงูู ุฑุง ุฐฺฉุฑ ูุฎูุงูุฏ ฺฉุฑุฏ. ุชุบุฑ ุฏูุฏ ุชุง ุงู ูุดฺฉู ุจุฑุทุฑู ุดูุฏ.</p>

<p>ุงฺฏุฑ ูุดฺฉู ุฏุฑ ุฏูุจุงู ฺฉุฑุฏู ุงู ููุงูู ุง ูุฏุฆู ุฏุงุดุชุฏุ ุงฺฏุฑ ูพุดููุงุฏ ุง ุงูุชูุงุฏ ุฏุงุดุชุฏุ ุง ุงฺฏุฑ ุณูุงู ุฏุงุดุชุฏุ ูุชูุงูุฏ ุงุฒ ุฑูุดโูุง ุฒุฑ ุจุง ูู ุชูุงุณ ุจฺฏุฑุฏ:</p>

<ol>
 <li>ูพุงู ูุณุชูู ุฏุฑ ุชูุชุฑ ุจู ุงฺฉุงูุช pykello_fa</li>
 <li>ุงูู ุจู hadi [at] moshayedi [dot] net.</li></ol>

<p>ููููู ฺฉู ููุช ฺฏุฐุงุดุชุฏ ู ุงูุฏูุงุฑู ุงุณุชูุงุฏู ฺฉุฑุฏู ุจุงุดุฏ.</p>
  <footer>
    <script type="text/javascript">
      !function(d,s,id){
          var js,fjs=d.getElementsByTagName(s)[0];
          if(!d.getElementById(id)){
              js=d.createElement(s);
              js.id=id;
              js.src="//platform.twitter.com/widgets.js";
              fjs.parentNode.insertBefore(js,fjs);
          }
      }(document,"script","twitter-wjs");
    </script>
    <a href="https://twitter.com/share"
       class="twitter-share-button"
       data-url="http://pykello.github.com/fa//fa/2021/04/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%DA%86%DA%AF%D9%88%D9%86%D9%87-%DA%A9%D8%A7%D8%B1-%D9%85%DB%8C-%DA%A9%D9%86%D8%AF-%D8%AC%D9%84%D8%B3%D9%87-%D8%AF%D9%88-%D8%AC%D8%AF%D9%88%D9%84-%D9%87%D8%A7%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85%DB%8C.html"
       data-dnt="true">
      "Tweet"</a>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.identifier = undefined;
        this.page.url = undefined;
        this.page.title = undefined;
        this.page.category_id = undefined;
      };
      var disqus_shortname = 'pykello';
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          dsq.setAttribute('data-timestamp', +new Date());
          (document.head || document.body).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </footer>
</article>
        </main>
        <footer>
            <hr />
            <p><a href="https://twitter.com/pykello"
                  class="twitter-follow-button"
                  data-show-count="false"
                  data-lang="en">
                 "Follow Hadi Moshayedi"
               </a>
               <script type="text/javascript">
                 !function(d,s,id){
                     var js,fjs=d.getElementsByTagName(s)[0];
                     if(!d.getElementById(id)){
                         js=d.createElement(s);
                         js.id=id;
                         js.src="//platform.twitter.com/widgets.js";
                         fjs.parentNode.insertBefore(js,fjs);
                     }
                 }(document,"script","twitter-wjs");
               </script></p>
          </footer>
    </div>
  </body>
</html>