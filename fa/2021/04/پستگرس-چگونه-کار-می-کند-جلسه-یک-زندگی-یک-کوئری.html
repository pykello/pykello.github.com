<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>ูพุณุชฺฏุฑุณ ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏุ ุฌูุณู ฺฉ - ุฒูุฏฺฏ ฺฉ ฺฉูุฆุฑ</title>
    <meta name="description" content="ุฏุฑ ุงู ููุดุชู ุฎูุงุตูโโุง ุงุฒ ูุฏุฆู ฺฉู ฺูุฏ ุฑูุฒ ูพุด ุจุง ุนููุงู ยซุฏุฑููุฌุงุช ูพุณุชฺฏุฑุณ - ุฒูุฏฺฏ ฺฉ ฺฉูุฆุฑยป ุถุจุท ฺฉุฑุฏู ุฑุง ุงุฑุงุฆู ูโุฏูู.  ูโุฎูุงูู ุจู ุงู ุณูุงู ุจูพุฑุฏุงุฒู ฺฉู ููุช ฺฉ ฺฉูุฆุฑ ูุซู `SELECT * FROM t` ุฏุฑ ูพุณุชฺฏุฑุณ ุงุฌุฑุง ูโฺฉููุ ฺู ุงุชูุงููุง ุฏุฑ ูพุดุช ุตุญูู ูโุงูุชุฏ.  ููฺฉ ู...">
    <meta name="author"      content="ูุงุฏ ูุดุฏ">
    <meta name="keywords"    content="ูพุณุชฺฏุฑุณ">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/fa/favicon.svg">
    <link rel="canonical" href="http://pykello.github.com/fa//fa/2021/04/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%DA%86%DA%AF%D9%88%D9%86%D9%87-%DA%A9%D8%A7%D8%B1-%D9%85%DB%8C-%DA%A9%D9%86%D8%AF-%D8%AC%D9%84%D8%B3%D9%87-%DB%8C%DA%A9-%D8%B2%D9%86%D8%AF%DA%AF%DB%8C-%DB%8C%DA%A9-%DA%A9%D9%88%D9%8A%D9%94%D8%B1%DB%8C.html">
    <link rel="next" href="/fa/2020/05/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%DA%86%DA%AF%D9%88%D9%86%D9%87-%DA%A9%D8%A7%D8%B1-%D9%85%DB%8C-%DA%A9%D9%86%D8%AF-%D8%AC%D9%84%D8%B3%D9%87-%D8%B5%D9%81%D8%B1.html">
    <link rel="prev" href="/fa/2021/04/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%DA%86%DA%AF%D9%88%D9%86%D9%87-%DA%A9%D8%A7%D8%B1-%D9%85%DB%8C-%DA%A9%D9%86%D8%AF-%D8%AC%D9%84%D8%B3%D9%87-%D8%AF%D9%88-%D8%AC%D8%AF%D9%88%D9%84-%D9%87%D8%A7%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85%DB%8C.html">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/fa/css/monochrome.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/fa/css/custom.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/fa/feeds/all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/fa/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>

    <!-- Header -->

    <header id="header" class="parent justify-spaceBetween">
      <div class="inner w100 relative">
        <span class="f-left">
          <a href="/fa">
            <h1>
              <span>the</span>lost<span>packet</span>
            </h1>
          </a>
        </span>
      </div>
    </header>

    <div id="container">
        <main>
            <article>
  <header>
    <h1>ูพุณุชฺฏุฑุณ ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏุ ุฌูุณู ฺฉ - ุฒูุฏฺฏ ฺฉ ฺฉูุฆุฑ</h1>
    <p class='date-and-tags'>
<time datetime="2021-04-05" pubdate="true">2021-04-05</time> :: <span class="tags"><a href="/fa/tags/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3.html">ูพุณุชฺฏุฑุณ</a></span></p>
    <p class='authors'><span class="authors">ูุงุฏ ูุดุฏ</span></p>
  </header>

<p>ุฏุฑ ุงู ููุดุชู ุฎูุงุตูโโุง ุงุฒ ูุฏุฆู ฺฉู ฺูุฏ ุฑูุฒ ูพุด ุจุง ุนููุงู ยซุฏุฑููุฌุงุช ูพุณุชฺฏุฑุณ - ุฒูุฏฺฏ ฺฉ ฺฉูุฆุฑยป ุถุจุท ฺฉุฑุฏู ุฑุง ุงุฑุงุฆู ูโุฏูู.</p>

<p>ูโุฎูุงูู ุจู ุงู ุณูุงู ุจูพุฑุฏุงุฒู ฺฉู ููุช ฺฉ ฺฉูุฆุฑ ูุซู <code>SELECT * FROM t</code> ุฏุฑ ูพุณุชฺฏุฑุณ ุงุฌุฑุง ูโฺฉููุ ฺู ุงุชูุงููุง ุฏุฑ ูพุดุช ุตุญูู ูโุงูุชุฏ.</p>

<p>ููฺฉ ูุฏุฆู: <a href="https://youtu.be/Z09rG7cLzF8">youtu.be/Z09rG7cLzF8</a></p>
<!-- more-->

<h3 id="ูพุดูุงุฒูุง">ูพุดโูุงุฒูุง</h3>

<p>ุงฺฏุฑ ูโุฎูุงูุฏ ฺฏุงูโูุง ฺฉู ุฏุฑ ุงู ููุงูู ุฐฺฉุฑ ุดุฏูโุงูุฏ ุฑุง ุงุฌุฑุง ฺฉูุฏุ ูุงุฒ ุฏุงุฑุฏ ูพุณุชฺฏุฑุณ ุฑุง ฺฉุงููพุงู ู ูุตุจ ฺฉูุฏุ ฺฉู ฺฏุงูโูุง ูุงุฒู ุจุฑุง ุงู ุงูุฑ ุฑุง ุฏุฑ  <a href="/fa/2020/05/ูพุณุชฺฏุฑุณ-ฺฺฏููู-ฺฉุงุฑ-ู-ฺฉูุฏ-ุฌูุณู-ุตูุฑ.html">ุงู ููุงูู</a> ุขูุฑุฏูโุงู.</p>

<p>ููฺูู ูุงุฒ ุจู ูุตุจ tcpflow ุฏุงุฑุฏ ฺฉู ุฏุฑ ุงูุจููุชู ุจุง ุฏุณุชูุฑ <code>sudo apt install tcpflow</code> ูโุชูุงูุฏ ูุตุจ ฺฉูุฏ.</p>

<h2 id="ูุตู-ุดุฏู-ฺฉูุงูุช-ุจู-ูพุณุชฺฏุฑุณ">ูุตู ุดุฏู ฺฉูุงูุช ุจู ูพุณุชฺฏุฑุณ</h2>

<p>ุจุฑุง ุงุฌุงุฏ ฺฉูุงุณุชุฑ ูพุณุชฺฏุฑุณ ู ุงุฌุฑุง ุขู ุฏุณุชูุฑุงุช ุฒุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:</p>

<pre><code>initdb -D data
pg_ctl -D data -l logfile</code></pre>

<p>ูพุณ ุงุฒ ุงูฺฉู ูพุณุชฺฏุฑุณ ุงุฌุงุฏ ุดุฏุ ฺฉ ูพุฑุฏุงุฒู ุงุตู ู ฺูุฏ ูพุฑุฏุงุฒู ูุฑุน ุงุฌุงุฏ ูโฺฉูุฏ. ูพุณ ุงุฒ ุงุฌุฑุง ุฏุณุชูุฑุงุช ุจุงูุงุ ูโุชูุงูู ุงุฒ ุฏุณุชูุฑ ps ุจุฑุง ุฏุฏู ูพุฑุฏุงุฒูโูุง ฺฉู ูพุณุชฺฏุฑุณ ุงุฌุงุฏ ฺฉุฑุฏู ุงุณุชูุงุฏู ฺฉูู:</p>

<pre><code>$ ps ef --forest -C postgres
  PID TTY      STAT   TIME COMMAND
24695 ?        Ss     0:00 /home/hadi/pg/12/bin/postgres -D data
24697 ?        Ss     0:00  \_ postgres: checkpointer
24698 ?        Ss     0:00  \_ postgres: background writer
24699 ?        Ss     0:00  \_ postgres: walwriter
24700 ?        Ss     0:00  \_ postgres: autovacuum launcher
24701 ?        Ss     0:00  \_ postgres: stats collector
24702 ?        Ss     0:00  \_ postgres: logical replication launcher</code></pre>

<p>ุฏุฑ ูุชุฌู ุจุงูุง ูพุฑุฏุงุฒู ุดูุงุฑู 24695 ูพุฑุฏุงุฒู ุงุตู ุงุณุช ู ุจูู ฺฉ ุณุฑ ูพุฑุฏุงุฒู ูุฑุจูุท ุจู ฺฉุงุฑูุง ุฏุงุฎู ูพุณุชฺฏุฑุณ.</p>

<h4 id="ูพุณุชฺฏุฑุณ-ุจุฑุง-ูุฑ-ฺฉูุงูุช-ฺฉ-ูพุฑุฏุงุฒู-ุฌุฏุง-ุงุฌุงุฏ-ูฺฉูุฏ">ูพุณุชฺฏุฑุณ ุจุฑุง ูุฑ ฺฉูุงูุช ฺฉ ูพุฑุฏุงุฒู ุฌุฏุง ุงุฌุงุฏ ูโฺฉูุฏ</h4>

<p>ุงฺฉููู ุฏู ูพูุฌุฑู ุจุงุฒ ฺฉูุฏ ู ุฏุฑ ูุฑ ฺฉุฏุงู ุงุฒ ุขููุง ุจุง ุจุฑูุงูู psql ุจู ูพุณุชฺฏุฑุณ ูุชุตู ุดูุฏ:</p>

<pre><code># window 1
$ psql -d postgres -h localhost

# window 2
$ psql -d postgres -h localhost</code></pre>

<p>ุฏุฑ ูพูุฌุฑูโุง ุฏฺฏุฑ ุฏุณุชูุฑ ps ุฑุง ุจุฑุง ุงูุชู ูพุฑุฏุงุฒูโูุง ูพุณุชฺฏุฑุณ ู psql ุงุฌุฑุง ฺฉูุฏ:</p>

<pre><code>$ ps ef --forest -C psql
  PID TTY      STAT   TIME COMMAND
24817 pts/7    S+     0:00 psql -d postgres -h localhost
24767 pts/6    S+     0:00 psql -d postgres -h localhost

$ ps ef --forest -C postgres
  PID TTY      STAT   TIME COMMAND
24695 ?        Ss     0:00 /home/hadi/pg/12/bin/postgres -D data
24697 ?        Ss     0:00  \_ postgres: checkpointer
24698 ?        Ss     0:00  \_ postgres: background writer
24699 ?        Ss     0:00  \_ postgres: walwriter
24700 ?        Ss     0:00  \_ postgres: autovacuum launcher
24701 ?        Ss     0:00  \_ postgres: stats collector
24702 ?        Ss     0:00  \_ postgres: logical replication launcher
24768 ?        Ss     0:00  \_ postgres: hadi postgres 127.0.0.1(55904) idle 4) idle
24818 ?        Ss     0:00  \_ postgres: hadi postgres 127.0.0.1(55906) idle 6) idle</code></pre>

<p>ููุงูุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏ ูพุณุชฺฏุฑุณ ุฏู ูพุฑุฏุงุฒู ุจู ุดูุงุฑู 24768 ู 24818 ุงุฌุงุฏ ฺฉุฑุฏู ฺฉู ูุฑ ฺฉุฏุงู ุงุฒ ุขูโูุง ุจู ูพุฑุฏุงุฒูโูุง psql ุจู ุดูุงุฑูโูุง 24817 ู 24767 ูุชุตู ุดุฏูโุงูุฏ.</p>

<p>ุญุช ุงฺฏุฑ ุจู ุฌุง psql ุจุฑูุงูู ุดูุง ุจูุฏ ฺฉู ุจู ูพุณุชฺฏุฑุณ ูุตู ูโุดุฏุ ุจุงุฒ ุดูุง ุจู ุงุฒุง ูุฑ ุงุฑุชุจุงุท ฺฉ ูพุฑุฏุงุฒู ุฌุฏุฏ ูโุฏุฏุฏ.</p>

<h4 id="ูพุณุชฺฏุฑุณ-ุงุฒ-ูพุฑูุชฺฉู-ูุงู-ุงุฑุชุจุงุท-tcp-ุจุฑุง-ุงุฑุชุจุงุท-ุจุง-ฺฉูุงูุชูุง-ุงุณุชูุงุฏู-ูฺฉูุฏ">ูพุณุชฺฏุฑุณ ุงุฒ ูพุฑูุชฺฉู ูุงู ุงุฑุชุจุงุท TCP ุจุฑุง ุงุฑุชุจุงุท ุจุง ฺฉูุงูุชโูุง ุงุณุชูุงุฏู ูโฺฉูุฏ.</h4>

<p>ููฺูุงู ฺฉู ุฏู ฺฉูุงูุช psql ุฏุฑ ุญุงู ุงุฌุฑุง ูุณุชูุฏุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุจุฑุง ูุณุช ฺฉุฑุฏู ุงุฑุชุจุงุทุงุช ุดุจฺฉู ุจู ูพุฑุฏุงุฒูโูุง ุงุฌุฑุง ฺฉูุฏ:</p>

<pre><code>$ lsof | grep "localhost:postgres"
postgres  24695  hadi  3u   IPv4    91393    0t0    TCP localhost:postgresql (LISTEN)
psql      24767  hadi  3u   IPv4    86470    0t0    TCP localhost:55904-&gt;localhost:postgresql (ESTABLISHED)
postgres  24768  hadi  8u   IPv4    91419    0t0    TCP localhost:postgresql-&gt;localhost:55904 (ESTABLISHED)
psql      24817  hadi  3u   IPv4    86481    0t0    TCP localhost:55906-&gt;localhost:postgresql (ESTABLISHED)
postgres  24818  hadi  8u   IPv4    91432    0t0    TCP localhost:postgresql-&gt;localhost:55906 (ESTABLISHED)</code></pre>

<p>ูพุณุชฺฏุฑุณ ุจู ุตูุฑุช ูพุดโูุฑุถ ุจู ูพูุฑุช 5432 ฺฏูุด ูโฺฉูุฏ. ุฏุณุชูุฑ lsof ุจุฑุง ุฎูุงูุง ุดุฏู ุฎุฑูุฌ ุจู ุฌุง 5432 ุงุฒ &ldquo;postgresql&rdquo; ุงุณุชูุงุฏู ฺฉุฑุฏู ุงุณุช.</p>

<p>ููุงุฑุฏ ฺฉู ุงุฒ ุฎุฑูุฌ ุจุงูุง ูโูููู:</p>

<ol>
 <li>ูพุฑุฏุงุฒู postgres ุจู ุดูุงุฑู 24695 ฺฉู ูพุฏุฑ ููู ูพุฑุฏุงุฒูโูุง ุฏุฑ ุฎุฑูุฌ ps ุจูุฏุ ุจู ูพูุฑุช TCP ูพุณุชฺฏุฑุณ ุง ููุงู 5432 ฺฏูุด ูโฺฉูุฏ ู ููุชุธุฑ ุฏุฑุฎูุงุณุช ุงุฑุชุจุงุท ุฌุฏุฏ ุงุณุช.</li>
 <li>ูพุฑุฏุงุฒู psql ุจุง ุดูุงุฑู 24767 ูพูุฑุช ูุญู 55904 ุฑุง ุจุฑุง ุงูุชุฎุงุจ ฺฉุฑุฏู ุงุณุช ู ุจู ูพุฑุฏุงุฒู postgres ุจุง ุดูุงุฑู 24768 ุจุง ุงุณุชูุงุฏู ูพูุฑุช TCP ูพุณุชฺฏุฑุณ ุง ููุงู 5432 ูุตู ุดุฏู ุงุณุช.</li>
 <li>ููฺูู ูพุฑุฏุงุฒู psql ุจู ุดูุงุฑู 24817 ุจู ูพุฑุฏุงุฒู postgres ุจุง ุดูุงุฑู 24818 ูุตู ุดุฏู ุงุณุช.</li></ol>

<h4 id="ูพุฑูุชฺฉู-ูุงู-ฺฉุงุฑุจุฑุฏ-ูพุณุชฺฏุฑุณ">ูพุฑูุชฺฉู ูุงู ฺฉุงุฑุจุฑุฏ ูพุณุชฺฏุฑุณ</h4>

<p>ุจุฑุง ูุดุงูุฏู ุงูฺฉู ฺฉูุงูุช ูพุณุชฺฏุฑุณ ฺฺฏููู ูพุฑุณุดโูุง ุฑุง ุจู ูพุณุชฺฏุฑุณ ูโูุฑุณุชุฏ ู ูพุณุชฺฏุฑุณ ฺฺฏููู ุจู ุงู ูพุฑุณุดโูุง ูพุงุณุฎ ูโุฏูุฏุ ุงุจุชุฏุง ุจุง ฺฉ ุงุฒ psql ูุง ฺฉู ุงุฌุฑุง ฺฉุฑุฏุฏุ ฺฉ ุฌุฏูู ุจุฑุง ุชูุฑู ุงุฌุงุฏ ฺฉูุฏ:</p>

<pre><code>create table t(a int, b text);
insert into t values (1, 'a'), (2, 'b');</code></pre>

<p>ุงฺฉููู ุฏุฑ ูพูุฌุฑูโุง ุฏฺฏุฑ ุฏุณุชูุฑ tcpflow ุฑุง ุจุฑุง ฺฏูุด ฺฉุฑุฏู ุจู ุชุฑุงูฺฉ ูพุณุชฺฏุฑุณ ุงุฌุฑุง ฺฉูุฏ:</p>

<pre><code>sudo tcpflow -D -c port 5432 -i lo</code></pre>

<p>ุฏุฑ ุฏุณุชูุฑ ุจุงูุง <code>port 5432</code> ูุดุฎุต ูโฺฉูุฏ ฺฉู ุจู ูพูุฑุช ูพุณุชฺฏุฑุณ ฺฏูุด ูโฺฉูู ู <code>-i lo</code> ูุดุฎุต ูโฺฉูุฏ ฺฉู ุจู ุฑุงุจุท ุดุจฺฉู ูุญู ฺฏูุด ูโุฏูู.</p>

<p>ุงฺฉููู ุฏุณุชูุฑ ุฒุฑ ุฑุง ุฏุฑ psql ุงุฌุฑุง ฺฉูุฏ ู ุฎุฑูุฌ ุขู ุฑุง ูุดุงูุฏู ฺฉูุฏ:</p>

<pre><code>postgres=# select * from t;
 a | b
---+---
 1 | a
 2 | b
(2 rows)</code></pre>

<p>ุฏุฑ ูพูุฌุฑู tcpflow ุฎุฑูุฌ ุดุจู ุฒุฑ ุฑุง ูุดุงูุฏู ุฎูุงูุฏ ฺฉุฑุฏ:</p>

<pre><code>127.000.000.001.55906-127.000.000.001.05432:
0000: 5100 0000 1573 656c 6563 7420 2a20 6672 6f6d 2074 3b00  Q....select * from t;.

127.000.000.001.05432-127.000.000.001.55906:
0000: 5400 0000 2e00 0261 0000 0040 0000 0100 0000 1700 04ff ffff ff00 0062 0000 0040  T......a...@...............b...@
0020: 0000 0200 0000 19ff ffff ffff ff00 0044 0000 0010 0002 0000 0001 3100 0000 0161  ...............D..........1....a
0040: 4400 0000 1000 0200 0000 0132 0000 0001 6243 0000 000d 5345 4c45 4354 2032 005a  D..........2....bC....SELECT 2.Z
0060: 0000 0005 49</code></pre>

<p>ฺฉู ุจุฎุด ุงูู ุงู ุฎุฑูุฌ ูุดุงู ูโุฏูุฏ ฺฉู ฺฉูุงูุช ฺฉูุฆุฑ ุฑุง ฺฺฏููู ุจู ูพุณุชฺฏุฑุณ ุงุฑุณุงู ฺฉุฑุฏุ ู ุจุฎุด ุฏูู ูุดุงู ูโุฏูุฏ ฺฉู ูพุณุชฺฏุฑุณ ุจุฑุง ูพุงุณุฎ ุจู ุงู ฺฉูุฆุฑ ฺู ุฏูุจุงูู ุงุฒ ุจุงุชโูุง ุฑุง ุจู ฺฉูุงูุช ูุฑุณุชุงุฏ. ุงฺฏุฑ ุจู ุจุฎุด ูพุงุณุฎ ุฏูุช ฺฉูุฏุ ุชูุงู ุงุทูุงุนุงุช ฺฉู ุฏุฑ ุฎุฑูุฌ ฺฉูุฆุฑ ุฏุฏ ุฑุง ุฏุฑ ุงูุฌุง ูุฒ ุชุดุฎุต ุฎูุงูุฏ ุฏุงุฏ.</p>

<p>ุจุฑุง ูุดุงูุฏู ุฌุฒุงุช ูพุฑูุชฺฉู ูพุณุชฺฏุฑุณ ุจู <a href="https://www.postgresql.org/docs/current/protocol-message-formats.html">ุจุฎุด ยซูุงูุจ ูพุงู ูพุฑูุชฺฉูยป ุฏุฑ ูุณุชูุฏุงุช ูพุณุชฺฏุฑุณ</a> ูุดุงูุฏู ฺฉูุฏ. ุจู ุนููุงู ูููููุ ุฏุฑ ูุณุชูุฏุงุช ุจุฑุง ูพุงู ฺฉูุฆุฑ ุขูุฏู ุงุณุช:</p>

<pre><code>Query (F)
  Byte1('Q')
     Identifies the message as a simple query.

  Int32
     Length of message contents in bytes, including self.

  String
     The query string itself.</code></pre>

<p>ู ุงฺฏุฑ ุจู ุฎุฑูุฌ tcpflow ุฏูุช ฺฉูุฏุ ุจุฑุง ุงุฑุณุงู ฺฉูุฆุฑ ุงุจุชุฏุง ฺฉ Q ุงุฑุณุงู ุดุฏุ ุณูพุณ ุทูู ฺฉูุฆุฑ ุจู ุตูุฑุช ฺฉ ุนุฏุฏ ุตุญุญ ด ุจุงุช (ุฏูุจุงูู 00 00 00 15 ุฏุฑ ุจุฎุด ูฺฏุฒุงุฏุณูุงู)ุ ู ุณูพุณ ุฎูุฏ ฺฉูุฆุฑ ุจู ุตูุฑุช ูุชู.</p>

<h2 id="ูพุฑุฏุงุฒุด-ฺฉูุฆุฑ">ูพุฑุฏุงุฒุด ฺฉูุฆุฑ</h2>

<p>ุจู ุฏุฑุงูุช ฺฉูุฆุฑ ู ุงุฑุณุงู ูพุงุณุฎ ฺู ุงุชูุงู ูโุงูุชุฏุ</p>

<p>ุจู ุตูุฑุช ฺฉูุ ูุฑุงุญ ูพุฑุฏุงุฒุด ฺฉูุฆุฑ ุนุจุงุฑุชูุฏ ุงุฒ:</p>

<p> <img src="/img/postgres-flow.svg" alt="Postgres Flow" /></p>

<h3 id="ูุฑุญูู-parse-ู-analyze">ูุฑุญูู Parse ู Analyze</h3>

<p>ูพุณ ุงุฒ ุงูฺฉู ูพุณุชฺฏุฑุณ ฺฉูุฆุฑ ุฑุง ุจู ุตูุฑุช ูุชู ุฏุฑุงูุช ฺฉุฑุฏุ ุขู ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูุฏ ู ุจู ุฏุงุฏู ุณุงุฎุชุงุฑ ุฏุงุฎู ฺฉูุฆุฑ ุชุจุฏู ูโฺฉูุฏ. ุงู ูุฑุญูู ุงุฒ ฒ ฺฏุงู ุชุดฺฉู ุดุฏู ุงุณุช:</p>

<ol>
 <li>ูุฑุญูู Parse ฺฉู ุชูุณุท ุชุงุจุน <a href="https://github.com/postgres/postgres/blob/1c1cbe279b3c6e8038c8f8079402f069bb4cea4c/src/backend/parser/parser.c#L42">raw_parser</a> ูพุงุฏูโุณุงุฒ ุดุฏู ู ุณุงุฎุชุงุฑ ฺฉู ฺฉูุฆุฑ ุฑุง ุฏุฑูโุขูุฑุฏ.</li>
 <li>ูุฑุญูู ุขูุงูุฒ ฺฉู ุชูุณุท ุชุงุจุน <a href="https://github.com/postgres/postgres/blob/055fee7eb4dcc78e58672aef146334275e1cc40d/src/backend/parser/analyze.c#L104">parse_analyze</a> ูพุงุฏูโุณุงุฒ ุดุฏู ู ุงุดุงุฑูโฺฏุฑูุง ููุฌูุฏ ุฏุฑ ฺฉูุฆุฑ ุฑุง ุงุฑุฒุงุจ ูโฺฉูุฏ. ูุซูุง ุงุดุงุฑูโฺฏุฑ ุจู ฺฉ ุฌุฏูู ุง ุณุชููโูุง ุฌุฏูู.</li></ol>

<p>ุงู ุฏุงุฏู ุณุงุฎุชุงุฑ ุฏุฑ ูุงู <a href="https://github.com/postgres/postgres/blob/055fee7eb4dcc78e58672aef146334275e1cc40d/src/include/nodes/parsenodes.h#L116">src/include/nodes/parsenodes.h</a> ุชุนุฑู ุดุฏู ุงุณุช:</p>

<pre><code>typedef struct Query
{
    NodeTag type;
    CmdType    commandType;
    QuerySource querySource;
...
}</code></pre>

<p>ุจุฑุง ุงูฺฉู ุญุงุตู ุงู ุชุจุฏู ุฑุง ุจุจูุฏุ ุงุจุชุฏุง ุชูุธูุงุช ุฒุฑ ุฑุง ุฏุฑ ูพูุฌุฑู psql ุงูุฌุงู ุฏูุฏ:</p>

<pre><code>set client_min_messages to log;
set debug_print_parse to true;</code></pre>

<p>ู ุณูพุณ ฺฉูุฆุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:</p>

<pre><code>select a, b from t;</code></pre>

<p>ุฎุฑูุฌ ูุฑุญูู Parse ุจู ุตูุฑุช ุฒุฑ ฺุงูพ ุฎูุงูุฏ ุดุฏ. ุจุฎุด ุงุฒ ุฎุฑูุฌ ุฑุง ุจู ุนูุช ุทููุงู ุจูุฏู ุญุฐู ฺฉุฑุฏูโุงู:</p>

<pre><code>LOG:  parse tree:
DETAIL:     {QUERY
   :commandType 1
...
   :rtable (
      {RTE
      :alias &lt;&gt;
      :eref
         {ALIAS
         :aliasname t
         :colnames ("a" "b")
         }
      :rtekind 0
      :relid 16384
...
      }
   )
...
   :targetList (
      {TARGETENTRY
      :expr
         {VAR
         :varno 1
         :varattno 1
         :vartype 23
...
         }
...
      }
      {TARGETENTRY
      :expr
         {VAR
         :varno 1
         :varattno 2
         :vartype 25
...
         }
...
      }
   )
...
   }</code></pre>

<p>ุงฺฉููู ุจู ุจุฑุฑุณ ุจุฎุดโูุง ุงุฒ ุงู ุฎุฑูุฌ ูโูพุฑุฏุงุฒู:</p>

<h4 id="ููุน-ฺฉูุฆุฑ">ููุน ฺฉูุฆุฑ</h4>

<p>ุจุฎุด ุงูู ฺฉู ุฏุฑ ุฎุฑูุฌ Parse ุจู ุขู ุฏูุช ูโฺฉููุ <code>:commandType 1</code> ุงุณุช ฺฉู ูุดุฎุต ูโฺฉูุฏ ฺฉู ุงู ฺฉูุฆุฑ SELECT ุงุณุช. ููุฏุงุฑ ุงู ูุชุบุฑ ุงุฒ ูุณุช ุซูุงุจุช ุฒุฑ ุฏุฑ ฺฉุฏ ูพุณุชฺฏุฑุณ ุงูุชุฎุงุจ ูโุดูุฏ:</p>

<pre><code>typedef enum CmdType
{
    CMD_UNKNOWN,
    CMD_SELECT,
    CMD_UPDATE,
    CMD_INSERT,
    CMD_DELETE,
    CMD_UTILITY, /* cmds like create, destroy, copy, vacuum, etc. */
    CMD_NOTHING
} CmdType;</code></pre>

<p>ููุงูุทูุฑ ฺฉู ูุฏุงูุฏุ ุฏุฑ ุฒุจุงู ุณ ุงุนุถุง enum ููุฏุงุฑ ุนุฏุฏ ูุนุงุฏู ูููุนุช ุฎูุฏ ุฑุง ุฏุฑุงูุช ูโฺฉููุฏุ ู ุฏุฑ ุงูุฌุง CMD_SELECT ูุนุงุฏู 1 ุฎูุงูุฏ ุจูุฏ.</p>

<ul>
 <li><a href="https://github.com/postgres/postgres/blob/9eacee2e62d89cab7b004f97c206c4fba4f1d745/src/include/nodes/nodes.h#L681">ููฺฉ ุชุนุฑู CmdType</a></li></ul>

<h4 id="ุงุทูุงุนุงุช-ูุฑุจูุท-ุจู-ุจุฎุด-from">ุงุทูุงุนุงุช ูุฑุจูุท ุจู ุจุฎุด FROM</h4>

<p>ุจุฎุด rtable ฺฉ ูุณุช ุงุฒ ููุงุฑุฏ ูุณุชูุฏ ฺฉู ุฏุฑ ุจุฎุด FROM ฺฉูุฆุฑ ุขูุฏู ุงุณุช. ฺฉู ุฏุฑ ุงู ููุฑุฏ ููุท ุฌุฏูู t ุงุณุช. ููุงูุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ ุจุง ฺฉ ุดูุงุฑู <code>:relid 16384โ</code> ูุดุฎุต ุดุฏู ุงุณุช. ูพุณุชฺฏุฑุณ ุงุทูุงุนุงุช ูุฑุจูุท ุจู ุฌุฏููโูุง ุฑุง ุฏุฑ ุฌุฏูู ุณุณุชู pg_class ูฺฏูุฏุงุฑ ูโฺฉูุฏ. ุจุฑุง ุงูฺฉู ุจุจูู ุจุฑุง ุฌุฏูู ูุง ฺู ุงุทูุงุนุงุช ุฐุฎุฑู ุดุฏู ุงุณุชุ ูโุชูุงูู ฺฉูุฆุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูู:</p>

<pre><code>\x

select * from pg_class where oid=16384;
-[ RECORD 1 ]-------+------
oid                 | 16384
relname             | t
relnamespace        | 2200
reltype             | 16386
reloftype           | 0
relowner            | 10
...</code></pre>

<p>ุฏุฑ ฺฉุฏ ุจุงูุง <code>\x</code> ุจุฑุง ุงู ุจูุฏ ฺฉู ูพุณุชฺฏุฑุณ ุจู ุฌุง ุณุชููุ ุฎุฑูุฌ ุฑุง ุจู ุตูุฑุช ุณุทุฑ ูุดุงู ุฏูุฏ.</p>

<h4 id="ุงุทูุงุนุงุช-ูุฑุจูุท-ุจู-ุณุชูููุง-ุงูุชุฎุงุจ-ุดุฏู">ุงุทูุงุนุงุช ูุฑุจูุท ุจู ุณุชููโูุง ุงูุชุฎุงุจ ุดุฏู</h4>

<p>ฺฉ ุงุฒ ุจุฎุดโูุง ุฌุงูุจ ุฎุฑูุฌ ูุฑุญูู Parse ูุณุช targetList ุงุณุช ฺฉู ุฏุฑ ุฎุฑูุฌ ุจุงูุง ฒ ุนูุตุฑ ุงุฒ ููุน TargetEntry ุฏุงุฑุฏ ฺฉู ูุฑ ฺฉุฏุงู ุดุงูู ฺฉ Var ุง ููุงู ูุชุบุฑ ุง ููุงู ฺฉ ุงุดุงุฑูโฺฏุฑ ุจู ุณุชููโูุง ุฌุฏูู ุงุณุช. ููุฏุงุฑ <code>varno</code> ุดูุงุฑู ุฌุฏูู ุฏุฑ ุจุฎุด FROM ู ููุฏุงุฑ <code>varattno</code> ุดูุงุฑู ุณุชูู ุฏุฑ ุขู ุฌุฏูู ุฑุง ูุดุฎุต ูโฺฉูุฏ. ูุซูุง ูุชุบุฑ ุฒุฑ ุนู ุณุชูู ุฏูู ุงุฒ ุฌุฏูู ุงูู:</p>

<pre><code>      {TARGETENTRY
      :expr
         {VAR
         :varno 1
         :varattno 2
         :vartype 25
...
         }
...
      }</code></pre>

<p>ููุฏุงุฑ <code>vartype</code> ุดูุงุฑู ููุน ุขู ุณุชูู ุฑุง ูุดุฎุต ูโฺฉูุฏ. ุงู ุดูุงุฑู ุจู ฺฉ ุณุทุฑ ุฏุฑ ุฌุฏูู <code>pg_type</code> ุงุดุงุฑู ูโฺฉูุฏ. ูุซูุง ุจุฑุง ููุน ุดูุงุฑู 23:</p>

<pre><code>select * from pg_type where oid=23;
-[ RECORD 1 ]--+---------
oid            | 23
typname        | int4
typnamespace   | 11
typowner       | 10
typlen         | 4
typbyval       | t
typtype        | b
...
typinput       | int4in
typoutput      | int4out
typreceive     | int4recv
typsend        | int4send
...</code></pre>

<p>ฺฉู ูุดุงู ูุฏูุฏ ููุน ุดูุงุฑู 23 ุนุฏุฏ ุตุญุญ ด ุจุงุช ุงุณุช ฺฉู ุชูุณุท int4out ุจู ุฑุดุชู ุชุจุฏู ูโุดูุฏ ู ุชูุณุท int4in ุงุฒ ุฑุดุชู ุงุฌุงุฏ ูโุดูุฏ. ุฏุฑ ูุฏุฆู ุจู ุจุฑุฑุณ ุจุดุชุฑ ุชุงุจุน int4in ูพุฑุฏุงุฎุชู.</p>

<ul>
 <li><a href="https://github.com/postgres/postgres/blob/ca3b37487be333a1d241dab1bbdd17a211a88f43/src/backend/utils/adt/int.c#L266">ููฺฉ ุชุนุฑู int4in</a></li>
 <li><a href="https://github.com/postgres/postgres/blob/ca3b37487be333a1d241dab1bbdd17a211a88f43/src/backend/utils/adt/numutils.c#L263">ููฺฉ ุชุนุฑู pg_strtoint32 ฺฉู int4in ุงุฒ ุขู ุงุณุชูุงุฏู ูโฺฉูุฏ</a></li></ul>

<h4 id="ูุฑุญูู-ุขูุงูุฒ">ูุฑุญูู ุขูุงูุฒ</h4>

<p>ุงฺฏุฑ ุฏุฑ ฺฉูุฆุฑ ุงุณู ุฌุฏูู ุฑุง ุงุดุชุจุงู ุจููุณูุ ุฎุทุง ุฑุฎ ุฎูุงูุฏ ุฏุงุฏ:</p>

<pre><code>select a, b from t2;
ERROR:  relation "t2" does not exist
LINE 1: select a, b from t2;</code></pre>

<p>ุงู ฺฉู ุขุง ูุงูุนุง ุฌุฏูู ุงุดุงุฑู ุดุฏู ู ุณุงุฑ ููุงุฑุฏ ุงุดุงุฑู ุดุฏู (ูุซู ุณุชููโูุง) ูุฌูุฏ ุฏุงุฑูุฏุ ุฏุฑ ูุฑุญู ุขูุงูุฒ ุงูุฌุงู ูโุดูุฏ.</p>

<p>ุฏุฑ ููุฑุฏ ูุงู ุฌุฏููุ ุชุงุจุน <code>transformSelectStmt</code> ุฏุฑ ูุฑุญูู ุขูุงูุฒ ุตุฏุง ูโุดูุฏ ฺฉู ูพุณ ุงุฒ ฺูุฏ ูุฑุญูู ุชุงุจุน <code>parserOpenTable</code> ุฑุง ุตุฏุง ูโฺฉูุฏ ฺฉู ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ูุงูุนุง ุฌุฏูู ูุฌูุฏ ุฏุงุฑุฏ ุง ูู ู ุฏุฑ ุตูุฑุช ุนุฏู ูุฌูุฏ ุฎุทุง ูโุฏูุฏ:</p>

<pre><code>Relation
parserOpenTable(ParseState *pstate, const RangeVar *relation, int lockmode)
{
    rel = table_openrv_extended(relation, lockmode, true);
    if (rel == NULL)
    {
...
                ereport(ERROR,
                        (errcode(ERRCODE_UNDEFINED_TABLE),
                         errmsg("relation \"%s\" does not exist",
                                relation-&gt;relname)));
...
    }
...
    return rel;
}</code></pre>

<ul>
 <li><a href="https://github.com/postgres/postgres/blob/055fee7eb4dcc78e58672aef146334275e1cc40d/src/backend/parser/analyze.c#L1200">ููฺฉ ุจู ุชุนุฑู transformSelectStmt</a></li>
 <li><a href="https://github.com/postgres/postgres/blob/055fee7eb4dcc78e58672aef146334275e1cc40d/src/backend/parser/parse_relation.c#L1350">ููฺฉ ุจู ุชุนุฑู parserOpenTable</a></li></ul>

<h3 id="ูุฑุญูู-ุจุงุฒููุณ-rewrite">ูุฑุญูู ุจุงุฒููุณ (Rewrite)</h3>

<p>ุฏุฑ ุงู ูุฑุญูู ุจุฑุง ุฎู ุงุฒ ฺฉูุฆุฑโูุง ู ุจู ุฎุตูุต ฺฉูุฆุฑ ุจุงูุง ูุง ุงุชูุงู ููโุงูุชุฏ ู ุญุงุตู ุจุงุฒููุณ ุฏููุง ููุงู ุญุงุตู ูุฑุญูู Parse ุงุณุช.</p>

<p>ูู ุงฺฏุฑ ฺฉูุฆุฑ ุดูุง ุดุงูู ฺฉ View ุจุงุดุฏุ ุญุงุตู ุจุฎุด parse ููุท ุดุงูู ุงุณู View ุงุณุช ู ุญุงุตู ูุฑุญูู ุจุงุฒููุณุ View ุฑุง ุจุง ฺฉูุฆุฑ ฺฉู ูุนุงุฏู View  ุงุณุช ุฌุงฺฏุฒู ูโุดูุฏ.</p>

<p>ุญุงุตู ุงู ูุฑุญูู ุฑุง ูโุชูุงูุฏ ุจุง ุฑูุดู ฺฉุฑุฏู <code>debug_print_rewritten</code> ูุดุงูุฏู ฺฉูุฏ.</p>

<p>ุจู ุนููุงู ูุซุงูุ ุฏุณุชูุฑุงุช ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:</p>

<pre><code>create view t_view as select count(*) from t;
set client_min_messages to log;
set debug_print_parse to true;
set debug_print_rewritten to true;</code></pre>

<p>ู ุณูพุณ ฺฉูุฆุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:</p>

<pre><code>SELECT * FROM t_view;</code></pre>

<p>ู ุฎุฑูุฌ ูุฑุงุญู Parse ู ุจุงุฒููุณ ุฑุง ููุงุณู ฺฉูุฏ.</p>

<p>ุฏุฑ ูุฏุฆู ุงู ฺฉุงุฑ ุฑุง ุงูุฌุงู ุฏุงุฏูุ ูู ุงูุฌุง ุจู ุฎุงุทุฑ ุญุฌู ุงุฒ ุงู ุจุฎุด ุนุจูุฑ ูโฺฉูู.</p>

<h3 id="ูุฑุญูู-ุงุฌุงุฏ-ุทุฑุญ-ุงุฌุฑุง-plan">ูุฑุญูู ุงุฌุงุฏ ุทุฑุญ ุงุฌุฑุง (Plan)</h3>

<p>ุชุง ุงู ูุฑุญูู ูพุณุชฺฏุฑุณ ฺฉูุฆุฑ ุฑุง Parse ฺฉุฑุฏู ุงุณุชุ ูู ูููุฒ ุชุตูู ูฺฏุฑูุชู ุงุณุช ุขู ุฑุง ฺฺฏููู ุงุฌุฑุง ฺฉูุฏ. ุฏุฑ ุงู ูุฑุญูู ุชุตูู ูโฺฏุฑุฏ ฺฉู ฺฉูุฆุฑ ูุฑุงุฑ ุงุณุช ฺฺฏููู ุงุฌุฑุง ุดูุฏ. ุญุงุตู ุงู ูุฑุญูู ฺฉ ููุฏุงุฑ ุงุฒ ููุน ุณุงุฎุชุงุฑ <a href="https://github.com/postgres/postgres/blob/055fee7eb4dcc78e58672aef146334275e1cc40d/src/include/nodes/plannodes.h#L42">PlannedStmt</a> ุงุณุช.</p>

<p>ุจุฑุง ูุดุงูุฏู ุญุงุตู ุงู ูุฑุญูู ูโุชูุงูุฏ ูพุงุฑุงูุชุฑ ุชูุธู debug_print_plan ุฑุง ูุนุงู ฺฉูุฏ:</p>

<pre><code>set client_min_messages to log;
set debug_print_plan to true;</code></pre>

<p>ุงฺฉููู ุงฺฏุฑ ฺฉูุฆุฑ ุฑุง ุงุฌุฑุง ฺฉููุ ุญุงุตู ุงู ูุฑุญูู ุจู ุตูุฑุช ุฒุฑ ฺุงูพ ุฎูุงูุฏ ุดุฏ ฺฉู ุจู ุนูุช ุตุฑููโุฌู ุฏุฑ ูุถุง ุจุฎุดโูุง ุงุฒ ุขู ุฑุง ุญุฐู ฺฉุฑุฏูโุงู</p>

<pre><code>postgres=# select a, b from t;
LOG:  plan:
DETAIL:     {PLANNEDSTMT 
	   :commandType 1 
...
	   :planTree 
	      {SEQSCAN 
...
	      :qual &lt;&gt; 
...
	      }
...
	   }</code></pre>

<p>ููุงูุทูุฑ ฺฉู ูุดุงูุฏู ูโฺฉูุฏุ ุทุฑุญ ุงุฌุฑุง ุงู ฺฉูุฆุฑ ุจุณุงุฑ ุณุงุฏู ู ุดุงูู ุชููุง ฺฉ SeqScan ุงุณุช ฺฉู ฺฉุฏ ูุฑุจูุท ุจู ุขู ุฑุง ูโุชูุงูุฏ ุฏุฑ <a href="https://github.com/postgres/postgres/blob/c30f54ad732ca5c8762bb68bbe0f51de9137dd72/src/backend/executor/nodeSeqscan.c">nodeSeqScan.c</a> ุจุงุจุฏ.</p>

<p>ุญุงู ฺฉูุฆุฑ ุฑุง ุจุง ุงูุฒูุฏู ฺฉ ุดุฑุท ูพฺุฏูโุชุฑ ูโฺฉูู ู ูุดุงูุฏู ูโฺฉูู ฺฉู ุจุฎุด qual ุญุงุตู ุชุบุฑ ูโฺฉูุฏ:</p>

<pre><code>postgres=# select a, b from t where a &gt; 1;
LOG:  plan:
DETAIL:     {PLANNEDSTMT 
	   :commandType 1 
...
	   :planTree 
	      {SEQSCAN 
...
	      :qual (
	         {OPEXPR 
	         :opno 521 
	         :opfuncid 147 
	         :opresulttype 16 
...
	         :args (
	            {VAR 
	            :varno 1 
	            :varattno 1 
...
	            }
	            {CONST 
	            :consttype 23 
...
	            :constvalue 4 [ 1 0 0 0 0 0 0 0 ]
	            }
	         )
	         :location 27
	         }
	      )
...
	      }
...
	   }</code></pre>

<p>ุงฺฉููู ุจุฎุด qual ฺฉ ููุฏุงุฑ ุงุฒ ููุน OpExpr ุงุณุช ฺฉู ุงุฒ ุชุงุจุน ุดูุงุฑู 147 ุจุฑุง ููุงุณู ุณุชูู ุงูู ุฌุฏูู ุจุง ุซุงุจุช ุตุญุญ 1 ุงุณุชูุงุฏู ูโฺฉูุฏ.</p>

<p>ุจุฑุง ุงูฺฉู ุจูููู ุชุงุจุน ุดูุงุฑู 147 ฺู ุชุงุจุน ุงุณุชุ ูโุชูุงูู ุจู ุฌุฏูู ุณุณุชู pg_proc ูุฑุงุฌุนู ฺฉูู:</p>

<pre><code>postgres=# select * from pg_proc where oid=147; 
-[ RECORD 1 ]---+-------
oid             | 147
proname         | int4gt
...
prorettype      | 16
proargtypes     | 23 23
...</code></pre>

<p>ูุดุงูุฏู ูโฺฉูู ฺฉู ุงุณู ุงู ุชุงุจุน int4gt ุงุณุช ฺฉู ฺฉุฏ ูุฑุจูุท ุจู ุขู ุฑุง ุฏุฑ <a href="https://github.com/postgres/postgres/blob/c30f54ad732ca5c8762bb68bbe0f51de9137dd72/src/backend/utils/adt/int.c#L411">src/backend/utils/adt/int.c</a> ูโุชูุงูุฏ ุจุงุจุฏ. ูพุงุฏูโุณุงุฒ ุงู ุชุงุจุน ุจุณุงุฑ ุณุงุฏู ุงุณุช ู ุฏู ุขุฑฺฏููุงู ุฑุง ููุงุณู ู ูุชุฌู ุฑุง ุจู ุตูุฑุช ุจููู ุจุฑูโฺฏุฑุฏุงูุฏ:</p>

<pre><code>Datum
int4gt(PG_FUNCTION_ARGS)
{
	int32		arg1 = PG_GETARG_INT32(0);
	int32		arg2 = PG_GETARG_INT32(1);

	PG_RETURN_BOOL(arg1 &gt; arg2);
}</code></pre>

<p>ุจุฑุง ุงูฺฉู ุจุชูุงูุฏ ุจู ุฌุง PlannedStmtุ ุทุฑุญ ุงุฌุฑุง ุจู ุตูุฑุช ุฎูุงูุงุชุฑ ุจุฑุง ุงูุณุงู ุฏุฑุงูุช ฺฉูุฏุ ูโุชูุงูุฏ ุงุฒ EXPLAIN ุงุณุชูุงุฏู ฺฉูุฏ:</p>

<pre><code>postgres=# explain select a, b from t where a &gt; 1;
                     QUERY PLAN
-----------------------------------------------------
 Seq Scan on t  (cost=0.00..25.88 rows=423 width=36)
   Filter: (a &gt; 1)
(2 rows)</code></pre>

<p>ุจุฑุง ูุดุงูุฏู ฺฉ ุทุฑุญ ุงุฌุฑุง ูพฺุฏูโุชุฑุ ุงุฒ ฺฉ join ุงุณุชูุงุฏู ูโฺฉูู:</p>

<pre><code>postgres=# explain select t1.a,t1.b, t2.a from t t1,t t2 where t1.a=t2.a;
                             QUERY PLAN
---------------------------------------------------------------------
 Merge Join  (cost=176.34..303.67 rows=8064 width=40)
   Merge Cond: (t1.a = t2.a)
   -&gt;  Sort  (cost=88.17..91.35 rows=1270 width=36)
         Sort Key: t1.a
         -&gt;  Seq Scan on t t1  (cost=0.00..22.70 rows=1270 width=36)
   -&gt;  Sort  (cost=88.17..91.35 rows=1270 width=4)
         Sort Key: t2.a
         -&gt;  Seq Scan on t t2  (cost=0.00..22.70 rows=1270 width=4)
(8 rows)</code></pre>

<p>ูุดุงูุฏู ูโฺฉูู ฺฉู ูพุณุชฺฏุฑุณ ุงุฒ ุงูฺฏูุฑุชู Merge Join ุจุฑุง ุงุฌุฑุง ุงู ฺฉูุฆุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ.</p>

<h4 id="ุจูููุณุงุฒ-ุทุฑุญ-ุงุฌุฑุง">ุจูููโุณุงุฒ ุทุฑุญ ุงุฌุฑุง</h4>

<p>ูพุณุชฺฏุฑุณ ุจุฑุง ุงุฌุฑุง ฺฉ ฺฉูุฆุฑ ูโุชูุงูุฏ ุงุฒ ุงูฺฏูุฑุชูโูุง ูุฎุชูู ุงุณุชูุงุฏู ฺฉูุฏ. ูุซูุง ุจุฑุง Join ูโุชูุงูุฏ ุงุฒ (ฑ) ูุฑุชุจโุณุงุฒ ู ุงุฏุบุงูุ ุง (ฒ) ุงุณุชูุงุฏู ุงุฒ ุฌุฏูู ูุดุ ุง (ณ) ุงุฒ ุญููู ุชู ุฏุฑ ุชู ุงุณุชูุงุฏู ฺฉูุฏ. ฺฉู ุฏุฑ ูุซุงู ุจุงูุง ุงุฒ ูุฑุชุจโุณุงุฒ ู ุงุฏุบุงู ุงุณุชูุงุฏู ฺฉุฑุฏ.</p>

<p>ุฏุฑ ูุฑุญูู ุจูููโุณุงุฒุ ูพุณุชฺฏุฑุณ ุทุฑุญโูุง ูุฎุชูู ุฑุง ุงุฌุงุฏ ูโฺฉูุฏุ ูุฒูู ูุฑ ฺฉุฏุงู ุฑุง ุชุฎูู ูุฒูุฏุ ู ฺฉู ูุฒููโุชุฑู ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ. ูุซูุง ุฏุฑ ูุซุงู ุจุงูุง ุชุฎูู ูพุณุชฺฏุฑุณ ุจุฑุง ูุฑ ูุฑุญูู ุฐฺฉุฑ ุดุฏู ู ุชุฎูู ูพุณุชฺฏุฑุณ ุจุฑุง ฺฉู ฺฉูุฆุฑ 303.67 ุงุณุช.</p>

<p>ุงฺฏุฑ ุจู ูุซุงู ุจุงูุง ุฏูุช ฺฉูุฏุ ูุดุงูุฏู ูโฺฉูุฏ ฺฉู ุชุฎูู ูพุณุชฺฏุฑุณ ุงุฒ ุชุนุฏุงุฏ ุณุทุฑูุง ุฌุฏูู t ูุงุฏุฑุณุช ุงุณุชุ ู ุจูุงุจุฑุงู ุดุงุฏ ุจูุชุฑู ุทุฑุญ ุงุฌุฑุง ุฑุง ุงูุชุฎุงุจ ูฺฉุฑุฏู ุจุงุดุฏ. ุจุฑุง ุงูฺฉู ูพุณุชฺฏุฑุณ ุจุชูุงูุฏ ุชุฎูู ุจูุชุฑ ุจุฒูุฏุ ุงุฒ ุฏุณุชูุฑ ANALYZE ุจุฑุง ุฌูุนโุขูุฑ ฺฉ ุณุฑ ุฏุงุฏู ุขูุงุฑ ุจุฑุง ุฌุฏูู ุงุณุชูุงุฏู ูโฺฉูู:</p>

<pre><code>ANALYZE t;</code></pre>

<p>ู ุฏูุจุงุฑู ุฏุณุชูุฑ EXPLAIN ุฑุง ุงุฌุฑุง ูโฺฉูู:</p>

<pre><code>postgres=# explain select t1.a,t1.b, t2.a from t t1,t t2 where t1.a=t2.a;
                           QUERY PLAN
----------------------------------------------------------------
 Nested Loop  (cost=0.00..2.10 rows=2 width=10)
   Join Filter: (t1.a = t2.a)
   -&gt;  Seq Scan on t t1  (cost=0.00..1.02 rows=2 width=6)
   -&gt;  Materialize  (cost=0.00..1.03 rows=2 width=4)
         -&gt;  Seq Scan on t t2  (cost=0.00..1.02 rows=2 width=4)
(5 rows)</code></pre>

<p>ูุดุงูุฏู ูโฺฉูู ฺฉู ูพุณุชฺฏุฑุณ ุงู ุฏูุนู ุชุฎููโูุง ุจูุชุฑ ุฒุฏู ุงุณุช ู ุชุตูู ฺฏุฑูุชู ุงุณุช ุจุฑุง ุงู ฺฉูุฆุฑ ุงุฒ ุญููู ุชู ุฏุฑ ุชู ุงุณุชูุงุฏู ฺฉูุฏ.</p>

<h3 id="ูุฑุญูู-ุงุฌุฑุง">ูุฑุญูู ุงุฌุฑุง</h3>

<p>ุฏุฑ ุงู ูุฑุญูู ูพุณุชฺฏุฑุณ ุทุฑุญ ุงุฌุฑุง ฺฉู ุฏุฑ ูุฑุญูู ูพุด ุงุฌุงุฏ ุดุฏ ุฑุง ุจู ุตูุฑุช ุจุงุฒฺฏุดุช ุงุฌุฑุง ูโฺฉูุฏ. ูุซูุง ุจุฑุง ุทุฑุญ ุงุฌุฑุง ุจุงูุงุ ฺฉุฏ ููุฌูุฏ ุฏุฑ   <a href="https://github.com/postgres/postgres/blob/c30f54ad732ca5c8762bb68bbe0f51de9137dd72/src/backend/executor/nodeSeqscan.c">nodeSeqScan.c</a> ุจุฑุง ุฎูุงูุฏู ุฌุฏููโูุงุ ู ฺฉุฏ ููุฌูุฏ ุฏุฑ <a href="https://github.com/postgres/postgres/blob/c30f54ad732ca5c8762bb68bbe0f51de9137dd72/src/backend/executor/nodeNestloop.c">nodeNestLoop.c</a> ุจุฑุง ุนูู Join ุจู ุตูุฑุช ุญููู ุชู ุฏุฑ ุชู ุงุฌุฑุง ูโุดูุฏ.</p>

<h2 id="ุชฺฉุงูู-ฺฉุงุฑ-ุฏุฑ-ุฎุงูู-">ุชฺฉุงูู ฺฉุงุฑ ุฏุฑ ุฎุงูู ๐</h2>

<ol>
 <li>ูพุณุชฺฏุฑุณ ุฑุง ฺฉุงููพุงู ู ูุตุจ ฺฉูุฏ ู ฺฉ ฺฉูุงุณุชุฑ ุงุฌุงุฏ ฺฉูุฏ.</li>
 <li>ูุฑุงุญู ุชูุถุญ ุดุฏู ุฏุฑ ุงู ููุงูู ุง ุฏุฑ ูุฏุฆู ุฑุง ุชุง ุฌุง ฺฉู ุจุฑุงุชุงู ุฌุงูุจ ุงุณุช ุงุฌุฑุง ฺฉูุฏ.</li>
 <li>ฺฉูุฆุฑโูุง ูุฎุชูู ุงุฌุฑุง ฺฉูุฏ ู ุญุงุตู ูุฑุงุญู Parse ู Plan ุฑุง ุจุฑุฑุณ ฺฉูุฏ.</li>
 <li>ฺฉุงููุชโูุง ูุฑุจูุท ุจู ุณุงุฎุชุงุฑ Query ุฑุง ุฏุฑ ูุงู <a href="https://github.com/postgres/postgres/blob/055fee7eb4dcc78e58672aef146334275e1cc40d/src/include/nodes/parsenodes.h">src/include/node/parsenodes.h</a> ุจุฎูุงูุฏ.</li>
 <li>ุณุน ฺฉูุฏ ูพุงุฏูโุณุงุฒ ุชุงุจุน pg_strtoint32 ุฑุง ุชุบุฑ ุฏูุฏ ู ุจู ุฌุง ุงุนุฏุงุฏ ููู ุงุฒ ุงุนุฏุงุฏ ูุซุจุช ุงุณุชูุงุฏู ฺฉูุฏุ ูู ูุชุบุฑ ุญุงุตู ุฑุง ุงุฒ ููุน ุนุฏุฏ ถด ุจุช ุฏุฑูุธุฑ ุจฺฏุฑุฏ ุชุง ูุดฺฉู ุฏุฑ ฺฉูุชุฑู ููุฏุงุฑ ูพุด ูุงุฏ. ุฏูุช ฺฉูุฏ ฺฉู ูพุงุฏูโุณุงุฒ ุงู ุชุงุจุน ุฑุง ุฏุฑ ุงู ููุงูู ุชูุถุญ ูุฏุงุฏู ู ุชููุง ุฏุฑ ูุฏุฆู ุชูุถุญ ุฏุงุฏู.</li></ol>

<p>ุงฺฏุฑ ูุดฺฉู ุฏุฑ ุฏูุจุงู ฺฉุฑุฏู ุงู ููุงูู ุง ูุฏุฆู ุฏุงุดุชุฏุ ุงฺฏุฑ ูพุดููุงุฏ ุง ุงูุชูุงุฏ ุฏุงุดุชุฏุ ุง ุงฺฏุฑ ุณูุงู ุฏุงุดุชุฏุ ูุชูุงูุฏ ุงุฒ ุฑูุดโูุง ุฒุฑ ุจุง ูู ุชูุงุณ ุจฺฏุฑุฏ:</p>

<ol>
 <li>ูพุงู ูุณุชูู ุฏุฑ ุชูุชุฑ ุจู ุงฺฉุงูุช pykello_fa</li>
 <li>ุงูู ุจู hadi [at] moshayedi [dot] net.</li></ol>

<p>ููููู ฺฉู ููุช ฺฏุฐุงุดุชุฏ ู ุงูุฏูุงุฑู ุงุณุชูุงุฏู ฺฉุฑุฏู ุจุงุดุฏ.</p>
  <footer>
    <script type="text/javascript">
      !function(d,s,id){
          var js,fjs=d.getElementsByTagName(s)[0];
          if(!d.getElementById(id)){
              js=d.createElement(s);
              js.id=id;
              js.src="//platform.twitter.com/widgets.js";
              fjs.parentNode.insertBefore(js,fjs);
          }
      }(document,"script","twitter-wjs");
    </script>
    <a href="https://twitter.com/share"
       class="twitter-share-button"
       data-url="http://pykello.github.com/fa//fa/2021/04/%D9%BE%D8%B3%D8%AA%DA%AF%D8%B1%D8%B3-%DA%86%DA%AF%D9%88%D9%86%D9%87-%DA%A9%D8%A7%D8%B1-%D9%85%DB%8C-%DA%A9%D9%86%D8%AF-%D8%AC%D9%84%D8%B3%D9%87-%DB%8C%DA%A9-%D8%B2%D9%86%D8%AF%DA%AF%DB%8C-%DB%8C%DA%A9-%DA%A9%D9%88%D9%8A%D9%94%D8%B1%DB%8C.html"
       data-dnt="true">
      "Tweet"</a>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.identifier = undefined;
        this.page.url = undefined;
        this.page.title = undefined;
        this.page.category_id = undefined;
      };
      var disqus_shortname = 'pykello';
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          dsq.setAttribute('data-timestamp', +new Date());
          (document.head || document.body).appendChild(dsq);
      })();
    </script>
    <noscript>
      Please enable JavaScript to view the
      <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
  </footer>
</article>
        </main>
        <footer>
            <hr />
            <p><a href="https://twitter.com/pykello"
                  class="twitter-follow-button"
                  data-show-count="false"
                  data-lang="en">
                 "Follow Hadi Moshayedi"
               </a>
               <script type="text/javascript">
                 !function(d,s,id){
                     var js,fjs=d.getElementsByTagName(s)[0];
                     if(!d.getElementById(id)){
                         js=d.createElement(s);
                         js.id=id;
                         js.src="//platform.twitter.com/widgets.js";
                         fjs.parentNode.insertBefore(js,fjs);
                     }
                 }(document,"script","twitter-wjs");
               </script></p>
          </footer>
    </div>
  </body>
</html>