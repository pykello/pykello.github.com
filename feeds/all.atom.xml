<?xml version="1.0" encoding="utf-8"?> 
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
 <title type="text">The Lost Packet: The Lost Packet</title>
 <link rel="self" href="https://pykello.github.com/feeds/all.atom.xml" />
 <link href="https://pykello.github.com/index.html" />
 <id>urn:https-pykello-github-com:-index-html</id>
 <updated>2019-06-20T07:00:00Z</updated>
 <entry>
  <title type="text">Citus Notes: COPY</title>
  <link rel="alternate" href="https://pykello.github.com/2019/06/citus-notes-copy.html?utm_source=all&amp;utm_medium=Atom" />
  <id>urn:https-pykello-github-com:-2019-06-citus-notes-copy-html</id>
  <published>2019-06-20T07:00:00Z</published>
  <updated>2019-06-20T07:00:00Z</updated>
  <author>
   <name>Hadi Moshayedi</name></author>
  <content type="html">
&lt;p&gt;(These are some notes I took while studying Citus code, so it is probably more detail oriented than higher picture oriented).&lt;/p&gt;

&lt;p&gt;Citus overrides the utility hook with &lt;a href="https://github.com/citusdata/citus/blob/6741ffd716593f09b22a01dab70f64d7c62922cd/src/backend/distributed/commands/utility_hook.c#L97"&gt;&lt;code&gt;multi_ProcessUtility&lt;/code&gt;&lt;/a&gt;. This function calls &lt;a href="https://github.com/citusdata/citus/blob/6741ffd716593f09b22a01dab70f64d7c62922cd/src/backend/distributed/commands/multi_copy.c#L2556"&gt;&lt;code&gt;ProcessCopyStmt()&lt;/code&gt;&lt;/a&gt; for COPY statements, which calls &lt;a href="https://github.com/citusdata/citus/blob/6741ffd716593f09b22a01dab70f64d7c62922cd/src/backend/distributed/commands/multi_copy.c#L181"&gt;&lt;code&gt;CitusCopyFrom()&lt;/code&gt;&lt;/a&gt;, which calls &lt;a href="https://github.com/citusdata/citus/blob/6741ffd716593f09b22a01dab70f64d7c62922cd/src/backend/distributed/commands/multi_copy.c#L317"&gt;&lt;code&gt;CopyToExistingShards()&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;CopyToExistingShards()&lt;/code&gt; uses the &lt;a href="https://github.com/postgres/postgres/blob/master/src/include/commands/copy.h"&gt;&lt;code&gt;postgres/src/include/commands/copy.h&lt;/code&gt;&lt;/a&gt; API to read tuples:&lt;/p&gt;

&lt;ul&gt;
 &lt;li&gt;&lt;code&gt;BeginCopyFrom()&lt;/code&gt;&lt;/li&gt;
 &lt;li&gt;&lt;code&gt;NextCopyFrom()&lt;/code&gt;&lt;/li&gt;
 &lt;li&gt;&lt;code&gt;EndCopyFrom()&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;

&lt;p&gt;and it uses the &lt;code&gt;CitusCopyDestReceiver&lt;/code&gt; API to write tuples. &lt;code&gt;CitusCopyDestReceiver&lt;/code&gt; is a specialization of postgresâ€™ DataReceiver, which contains the following methods:&lt;/p&gt;

&lt;ul&gt;
 &lt;li&gt;&lt;code&gt;rStartup&lt;/code&gt;/&lt;code&gt;rShutdown&lt;/code&gt;: per-executor-run initialization and shutdown&lt;/li&gt;
 &lt;li&gt;&lt;code&gt;rDestroy&lt;/code&gt;: destroy the object itself.&lt;/li&gt;
 &lt;li&gt;&lt;code&gt;receiveSlot&lt;/code&gt;: called for each tuple to be output.&lt;/li&gt;&lt;/ul&gt;&lt;a href="https://pykello.github.com/2019/06/citus-notes-copy.html?utm_source=all&amp;amp;utm_medium=Atom"&gt;&lt;em&gt;More&amp;hellip;&lt;/em&gt;&lt;/a&gt;</content></entry>
 <entry>
  <title type="text">A better viewer for PostgreSQL debug trees</title>
  <link rel="alternate" href="https://pykello.github.com/2019/04/a-better-viewer-for-postgresql-debug-trees.html?utm_source=all&amp;utm_medium=Atom" />
  <id>urn:https-pykello-github-com:-2019-04-a-better-viewer-for-postgresql-debug-trees-html</id>
  <published>2019-04-13T07:00:00Z</published>
  <updated>2019-04-13T07:00:00Z</updated>
  <author>
   <name>Hadi Moshayedi</name></author>
  <content type="html">
&lt;p&gt;If you set &lt;code&gt;debug_print_parse&lt;/code&gt;, &lt;code&gt;debug_print_rewritten&lt;/code&gt;, or &lt;code&gt;debug_print_plan&lt;/code&gt; to true, PostgreSQL will log some of the interesting internal data structures during the query execution. But these logs are usually too long and difficult to inspect.&lt;/p&gt;

&lt;p&gt;I recently switched to using &lt;a href="https://docs.racket-lang.org/frog/index.html"&gt;Frog&lt;/a&gt; to generate my blog. Last week I wrote a little Frog plugin to allow me embed these trees in a nice tree view in blog posts.&lt;/p&gt;&lt;a href="https://pykello.github.com/2019/04/a-better-viewer-for-postgresql-debug-trees.html?utm_source=all&amp;amp;utm_medium=Atom"&gt;&lt;em&gt;More&amp;hellip;&lt;/em&gt;&lt;/a&gt;</content></entry>
 <entry>
  <title type="text">PostgreSQL Internals: TRUNCATE</title>
  <link rel="alternate" href="https://pykello.github.com/2019/03/postgresql-internals-truncate.html?utm_source=all&amp;utm_medium=Atom" />
  <id>urn:https-pykello-github-com:-2019-03-postgresql-internals-truncate-html</id>
  <published>2019-03-20T07:00:00Z</published>
  <updated>2019-03-20T07:00:00Z</updated>
  <author>
   <name>Hadi Moshayedi</name></author>
  <content type="html">
&lt;p&gt;You can use TRUNCATE in postgres to delete all of the rows in a table. The main advantage of it compared to using DELETE is performance. For example, using DELETE to delete all rows in a table with 1 million rows takes about 2.3 seconds, but truncating the same table would take about 10ms.&lt;/p&gt;

&lt;p&gt;But how does postgres implement TRUNCATE that it is so fast?&lt;/p&gt;&lt;a href="https://pykello.github.com/2019/03/postgresql-internals-truncate.html?utm_source=all&amp;amp;utm_medium=Atom"&gt;&lt;em&gt;More&amp;hellip;&lt;/em&gt;&lt;/a&gt;</content></entry>
 <entry>
  <title type="text">cstore_fdw and 'Files are Hard'</title>
  <link rel="alternate" href="https://pykello.github.com/2015/12/cstore-fdw-and-files-are-hard.html?utm_source=all&amp;utm_medium=Atom" />
  <id>urn:https-pykello-github-com:-2015-12-cstore-fdw-and-files-are-hard-html</id>
  <published>2015-12-15T08:00:00Z</published>
  <updated>2015-12-15T08:00:00Z</updated>
  <author>
   <name>Hadi Moshayedi</name></author>
  <content type="html">
&lt;p&gt;I recently came accross the "&lt;a href="http://danluu.com/file-consistency/"&gt;Files are hard&lt;/a&gt;" article, and it made me wonder how reliable is cstore_fdw&amp;rsquo;s design and implementation. &lt;a href="https://github.com/citusdata/cstore_fdw/"&gt;cstore_fdw&lt;/a&gt; is a columnar store for PostgreSQL that I designed and developed in my previous job at Citus Data.&lt;/p&gt;

&lt;p&gt;I am writing this post so my decisions for cstore_fdw&amp;rsquo;s design get reviewed by more people, and I get some feedback and improve the design.&lt;/p&gt;&lt;a href="https://pykello.github.com/2015/12/cstore-fdw-and-files-are-hard.html?utm_source=all&amp;amp;utm_medium=Atom"&gt;&lt;em&gt;More&amp;hellip;&lt;/em&gt;&lt;/a&gt;</content></entry>
 <entry>
  <title type="text">Haskell Skyline</title>
  <link rel="alternate" href="https://pykello.github.com/2015/12/haskell-skyline.html?utm_source=all&amp;utm_medium=Atom" />
  <id>urn:https-pykello-github-com:-2015-12-haskell-skyline-html</id>
  <published>2015-12-12T08:00:00Z</published>
  <updated>2015-12-12T08:00:00Z</updated>
  <author>
   <name>Hadi Moshayedi</name></author>
  <content type="html">
&lt;p&gt;Recently I started learning Haskell by studying the &lt;a href="https://www.edx.org/course/introduction-functional-programming-delftx-fp101x-0"&gt;Intro to FP Programming&lt;/a&gt; course on Edx. Since then, I try to model different problems using Haskell.&lt;/p&gt;

&lt;p&gt;One of these problems is the Skyline problem, which goes like this:&lt;/p&gt;

&lt;blockquote&gt;
 &lt;p&gt;You are given a set of rectangular buildings in a city, and you should return the skyline view of the city. Input is a sequence of tuples &lt;code&gt;(x_{left}, height,
x_{right})&lt;/code&gt;, each describing a building. The output is a sequence of pairs &lt;code&gt;(x, height)&lt;/code&gt; meaning that the height of skyline changed to &lt;code&gt;height&lt;/code&gt; at the given x coordinate.&lt;/p&gt;&lt;/blockquote&gt;&lt;a href="https://pykello.github.com/2015/12/haskell-skyline.html?utm_source=all&amp;amp;utm_medium=Atom"&gt;&lt;em&gt;More&amp;hellip;&lt;/em&gt;&lt;/a&gt;</content></entry></feed>